/*! For license information please see did-jwt.js.LICENSE.txt */
var e={84:e=>{e.exports=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var n=0;n<e.length;n++){var o=e.charAt(n),i=o.charCodeAt(0);if(255!==t[i])throw new TypeError(o+" is ambiguous");t[i]=n}var s=e.length,f=e.charAt(0),c=Math.log(s)/Math.log(256),a=Math.log(256)/Math.log(s);function u(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var r=0;if(" "!==e[r]){for(var n=0,o=0;e[r]===f;)n++,r++;for(var i=(e.length-r)*c+1>>>0,a=new Uint8Array(i);e[r];){var u=t[e.charCodeAt(r)];if(255===u)return;for(var h=0,d=i-1;(0!==u||h<o)&&-1!==d;d--,h++)u+=s*a[d]>>>0,a[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");o=h,r++}if(" "!==e[r]){for(var l=i-o;l!==i&&0===a[l];)l++;for(var p=new Uint8Array(n+(i-l)),y=n;l!==i;)p[y++]=a[l++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,o=0,i=t.length;o!==i&&0===t[o];)o++,r++;for(var c=(i-o)*a+1>>>0,u=new Uint8Array(c);o!==i;){for(var h=t[o],d=0,l=c-1;(0!==h||d<n)&&-1!==l;l--,d++)h+=256*u[l]>>>0,u[l]=h%s>>>0,h=h/s>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,o++}for(var p=c-n;p!==c&&0===u[p];)p++;for(var y=f.repeat(r);p<c;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:u,decode:function(e){var t=u(e);if(t)return t;throw new Error("Non-base"+s+" character")}}}},341:e=>{e.exports=function e(t){if("number"==typeof t&&isNaN(t))throw new Error("NaN is not allowed");if("number"==typeof t&&!isFinite(t))throw new Error("Infinity is not allowed");return null===t||"object"!=typeof t?JSON.stringify(t):t.toJSON instanceof Function?e(t.toJSON()):Array.isArray(t)?`[${t.reduce(((t,r,n)=>`${t}${0===n?"":","}${e(void 0===r||"symbol"==typeof r?null:r)}`),"")}]`:`{${Object.keys(t).sort().reduce(((r,n)=>void 0===t[n]||"symbol"==typeof t[n]?r:`${r}${0===r.length?"":","}${e(n)}:${e(t[n])}`),"")}}`}},417:e=>{e.exports={rfc4648:e=>t=>({encode:r=>((e,t,r)=>{const n="="===t[t.length-1],o=(1<<r)-1;let i="",s=0,f=0;for(let n=0;n<e.length;++n)for(f=f<<8|e[n],s+=8;s>r;)s-=r,i+=t[o&f>>s];if(s&&(i+=t[o&f<<r-s]),n)for(;i.length*r&7;)i+="=";return i})(r,t,e),decode:r=>((e,t,r)=>{const n={};for(let e=0;e<t.length;++e)n[t[e]]=e;let o=e.length;for(;"="===e[o-1];)--o;const i=new Uint8Array(o*r/8|0);let s=0,f=0,c=0;for(let t=0;t<o;++t){const o=n[e[t]];if(void 0===o)throw new SyntaxError("Invalid character "+e[t]);f=f<<r|o,s+=r,s>=8&&(s-=8,i[c++]=255&f>>s)}if(s>=r||255&f<<8-s)throw new SyntaxError("Unexpected end of data");return i})(r,t,e)})}},466:(e,t,r)=>{const n=r(579),{encodeText:o,decodeText:i,concat:s}=r(703);function f(e){if(Object.prototype.hasOwnProperty.call(n.names,e))return n.names[e];if(Object.prototype.hasOwnProperty.call(n.codes,e))return n.codes[e];throw new Error(`Unsupported encoding: ${e}`)}(t=e.exports=function(e,t){if(!t)throw new Error("requires an encoded Uint8Array");const{name:r,codeBuf:n}=f(e);return function(e,t){f(e).decode(i(t))}(r,t),s([n,t],n.length+t.length)}).encode=function(e,t){const r=f(e),n=o(r.encode(t));return s([r.codeBuf,n],r.codeBuf.length+n.length)},t.decode=function(e){e instanceof Uint8Array&&(e=i(e));const t=e[0];return["f","F","v","V","t","T","b","B","c","C","h","k","K"].includes(t)&&(e=e.toLowerCase()),f(e[0]).decode(e.substring(1))},t.isEncoded=function(e){if(e instanceof Uint8Array&&(e=i(e)),"[object String]"!==Object.prototype.toString.call(e))return!1;try{return f(e[0]).name}catch(e){return!1}},t.encoding=f,t.encodingFromData=function(e){return e instanceof Uint8Array&&(e=i(e)),f(e[0])};const c=Object.freeze(n.names),a=Object.freeze(n.codes);t.names=c,t.codes=a},579:(e,t,r)=>{const n=r(84),o=r(633),{rfc4648:i}=r(417),{decodeText:s,encodeText:f}=r(703),c=[["identity","\0",()=>({encode:s,decode:f}),""],["base2","0",i(1),"01"],["base8","7",i(3),"01234567"],["base10","9",n,"0123456789"],["base16","f",i(4),"0123456789abcdef"],["base16upper","F",i(4),"0123456789ABCDEF"],["base32hex","v",i(5),"0123456789abcdefghijklmnopqrstuv"],["base32hexupper","V",i(5),"0123456789ABCDEFGHIJKLMNOPQRSTUV"],["base32hexpad","t",i(5),"0123456789abcdefghijklmnopqrstuv="],["base32hexpadupper","T",i(5),"0123456789ABCDEFGHIJKLMNOPQRSTUV="],["base32","b",i(5),"abcdefghijklmnopqrstuvwxyz234567"],["base32upper","B",i(5),"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"],["base32pad","c",i(5),"abcdefghijklmnopqrstuvwxyz234567="],["base32padupper","C",i(5),"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567="],["base32z","h",i(5),"ybndrfg8ejkmcpqxot1uwisza345h769"],["base36","k",n,"0123456789abcdefghijklmnopqrstuvwxyz"],["base36upper","K",n,"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"],["base58btc","z",n,"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"],["base58flickr","Z",n,"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"],["base64","m",i(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"],["base64pad","M",i(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="],["base64url","u",i(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"],["base64urlpad","U",i(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_="]],a=c.reduce(((e,t)=>(e[t[0]]=new o(t[0],t[1],t[2],t[3]),e)),{}),u=c.reduce(((e,t)=>(e[t[1]]=a[t[0]],e)),{});e.exports={names:a,codes:u}},633:(e,t,r)=>{const{encodeText:n}=r(703);e.exports=class{constructor(e,t,r,o){this.name=e,this.code=t,this.codeBuf=n(this.code),this.alphabet=o,this.codec=r(o)}encode(e){return this.codec.encode(e)}decode(e){for(const t of e)if(this.alphabet&&this.alphabet.indexOf(t)<0)throw new Error(`invalid character '${t}' in '${e}'`);return this.codec.decode(e)}}},703:e=>{const t=new TextDecoder,r=new TextEncoder;e.exports={decodeText:e=>t.decode(e),encodeText:e=>r.encode(e),concat:function(e,t){const r=new Uint8Array(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return r}}}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};r.r(n),r.d(n,{identity:()=>O});var o={};r.r(o),r.d(o,{base2:()=>R});var i={};r.r(i),r.d(i,{base8:()=>T});var s={};r.r(s),r.d(s,{base10:()=>N});var f={};r.r(f),r.d(f,{base16:()=>C,base16upper:()=>K});var c={};r.r(c),r.d(c,{base32:()=>L,base32hex:()=>_,base32hexpad:()=>F,base32hexpadupper:()=>H,base32hexupper:()=>V,base32pad:()=>$,base32padupper:()=>j,base32upper:()=>D,base32z:()=>z});var a={};r.r(a),r.d(a,{base36:()=>J,base36upper:()=>M});var u={};r.r(u),r.d(u,{base58btc:()=>W,base58flickr:()=>q});var h={};r.r(h),r.d(h,{base64:()=>G,base64pad:()=>Z,base64url:()=>X,base64urlpad:()=>Y});var d={};r.r(d),r.d(d,{base256emoji:()=>re});var l={};r.r(l),r.d(l,{sha256:()=>Se,sha512:()=>Ie});var p={};r.r(p),r.d(p,{identity:()=>Ue});var y={};r.r(y),r.d(y,{code:()=>Oe,decode:()=>Te,encode:()=>Re,name:()=>Pe});var w={};function g(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function b(e=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?g(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function m(e,t){t||(t=e.reduce(((e,t)=>e+t.length),0));const r=b(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return g(r)}r.r(w),r.d(w,{code:()=>Le,decode:()=>$e,encode:()=>De,name:()=>Ke});const v=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<e.length;o++){var i=e.charAt(o),s=i.charCodeAt(0);if(255!==r[s])throw new TypeError(i+" is ambiguous");r[s]=o}var f=e.length,c=e.charAt(0),a=Math.log(f)/Math.log(256),u=Math.log(256)/Math.log(f);function h(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,o=0;e[t]===c;)n++,t++;for(var i=(e.length-t)*a+1>>>0,s=new Uint8Array(i);e[t];){var u=r[e.charCodeAt(t)];if(255===u)return;for(var h=0,d=i-1;(0!==u||h<o)&&-1!==d;d--,h++)u+=f*s[d]>>>0,s[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");o=h,t++}if(" "!==e[t]){for(var l=i-o;l!==i&&0===s[l];)l++;for(var p=new Uint8Array(n+(i-l)),y=n;l!==i;)p[y++]=s[l++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,o=0,i=t.length;o!==i&&0===t[o];)o++,r++;for(var s=(i-o)*u+1>>>0,a=new Uint8Array(s);o!==i;){for(var h=t[o],d=0,l=s-1;(0!==h||d<n)&&-1!==l;l--,d++)h+=256*a[l]>>>0,a[l]=h%f>>>0,h=h/f>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,o++}for(var p=s-n;p!==s&&0===a[p];)p++;for(var y=c.repeat(r);p<s;++p)y+=e.charAt(a[p]);return y},decodeUnsafe:h,decode:function(e){var r=h(e);if(r)return r;throw new Error(`Non-${t} character`)}}},E=(new Uint8Array(0),e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")});class x{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class A{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return S(this,e)}}class B{constructor(e){this.decoders=e}or(e){return S(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const S=(e,t)=>new B({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class I{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new x(e,t,r),this.decoder=new A(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const k=({name:e,prefix:t,encode:r,decode:n})=>new I(e,t,r,n),U=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:o}=v(r,t);return k({prefix:e,name:t,encode:n,decode:e=>E(o(e))})},P=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>k({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],o=(1<<r)-1;let i="",s=0,f=0;for(let n=0;n<e.length;++n)for(f=f<<8|e[n],s+=8;s>r;)s-=r,i+=t[o&f>>s];if(s&&(i+=t[o&f<<r-s]),n)for(;i.length*r&7;)i+="=";return i})(e,n,r),decode:t=>((e,t,r,n)=>{const o={};for(let e=0;e<t.length;++e)o[t[e]]=e;let i=e.length;for(;"="===e[i-1];)--i;const s=new Uint8Array(i*r/8|0);let f=0,c=0,a=0;for(let t=0;t<i;++t){const i=o[e[t]];if(void 0===i)throw new SyntaxError(`Non-${n} character`);c=c<<r|i,f+=r,f>=8&&(f-=8,s[a++]=255&c>>f)}if(f>=r||255&c<<8-f)throw new SyntaxError("Unexpected end of data");return s})(t,n,r,e)}),O=k({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),R=P({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),T=P({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),N=U({prefix:"9",name:"base10",alphabet:"0123456789"}),C=P({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),K=P({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),L=P({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),D=P({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),$=P({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),j=P({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),_=P({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),V=P({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),F=P({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),H=P({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),z=P({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),J=U({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),M=U({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),W=U({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),q=U({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),G=P({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Z=P({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),X=P({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Y=P({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Q=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),ee=Q.reduce(((e,t,r)=>(e[r]=t,e)),[]),te=Q.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]),re=k({prefix:"🚀",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+ee[t]),"")},decode:function(e){const t=[];for(const r of e){const e=te[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}});var ne=128,oe=-128,ie=Math.pow(2,31),se=128,fe=127,ce=Math.pow(2,7),ae=Math.pow(2,14),ue=Math.pow(2,21),he=Math.pow(2,28),de=Math.pow(2,35),le=Math.pow(2,42),pe=Math.pow(2,49),ye=Math.pow(2,56),we=Math.pow(2,63);const ge={encode:function e(t,r,n){r=r||[];for(var o=n=n||0;t>=ie;)r[n++]=255&t|ne,t/=128;for(;t&oe;)r[n++]=255&t|ne,t>>>=7;return r[n]=0|t,e.bytes=n-o+1,r},decode:function e(t,r){var n,o=0,i=0,s=r=r||0,f=t.length;do{if(s>=f)throw e.bytes=0,new RangeError("Could not decode varint");n=t[s++],o+=i<28?(n&fe)<<i:(n&fe)*Math.pow(2,i),i+=7}while(n>=se);return e.bytes=s-r,o},encodingLength:function(e){return e<ce?1:e<ae?2:e<ue?3:e<he?4:e<de?5:e<le?6:e<pe?7:e<ye?8:e<we?9:10}},be=(e,t,r=0)=>(ge.encode(e,t,r),t),me=e=>ge.encodingLength(e),ve=(e,t)=>{const r=t.byteLength,n=me(e),o=n+me(r),i=new Uint8Array(o+r);return be(e,i,0),be(r,i,n),i.set(t,o),new Ee(e,r,t,i)};class Ee{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const xe=({name:e,code:t,encode:r})=>new Ae(e,t,r);class Ae{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?ve(this.code,t):t.then((e=>ve(this.code,e)))}throw Error("Unknown type, must be binary type")}}const Be=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Se=xe({name:"sha2-256",code:18,encode:Be("SHA-256")}),Ie=xe({name:"sha2-512",code:19,encode:Be("SHA-512")}),ke=E,Ue={code:0,name:"identity",encode:ke,digest:e=>ve(0,ke(e))},Pe="raw",Oe=85,Re=e=>E(e),Te=e=>E(e),Ne=new TextEncoder,Ce=new TextDecoder,Ke="json",Le=512,De=e=>Ne.encode(JSON.stringify(e)),$e=e=>JSON.parse(Ce.decode(e));Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"),Symbol.for("@ipld/js-cid/CID");const je={...n,...o,...i,...s,...f,...c,...a,...u,...h,...d};function _e(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const Ve=_e("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),Fe=_e("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=b((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t})),He={utf8:Ve,"utf-8":Ve,hex:je.base16,latin1:Fe,ascii:Fe,binary:Fe,...je};function ze(e,t="utf8"){const r=He[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):g(globalThis.Buffer.from(e,"utf-8"))}function Je(e,t="utf8"){const r=He[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}const Me="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function We(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function qe(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function Ge(e,...t){if(!We(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function Ze(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Xe(e,t){Ge(e);const r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Ye(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function Qe(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function et(e,t){return e<<32-t|e>>>t}function tt(e,t){return e<<t|e>>>32-t>>>0}const rt=(()=>68===new Uint8Array(new Uint32Array([287454020]).buffer)[0])()?e=>e:function(e){for(let r=0;r<e.length;r++)e[r]=(t=e[r])<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255;var t;return e},nt=(()=>"function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex)(),ot=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function it(e){if(Ge(e),nt)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=ot[e[r]];return t}function st(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:void 0}function ft(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);if(nt)return Uint8Array.fromHex(e);const t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(r);for(let t=0,o=0;t<r;t++,o+=2){const r=st(e.charCodeAt(o)),i=st(e.charCodeAt(o+1));if(void 0===r||void 0===i){const t=e[o]+e[o+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+o)}n[t]=16*r+i}return n}function ct(e){return"string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(e))}(e)),Ge(e),e}function at(...e){let t=0;for(let r=0;r<e.length;r++){const n=e[r];Ge(n),t+=n.length}const r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){const o=e[t];r.set(o,n),n+=o.length}return r}class ut{}function ht(e){const t=t=>e().update(ct(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function dt(e=32){if(Me&&"function"==typeof Me.getRandomValues)return Me.getRandomValues(new Uint8Array(e));if(Me&&"function"==typeof Me.randomBytes)return Uint8Array.from(Me.randomBytes(e));throw new Error("crypto.getRandomValues must be defined")}function lt(e,t,r){return e&t^e&r^t&r}class pt extends ut{constructor(e,t,r,n){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=n,this.buffer=new Uint8Array(e),this.view=Qe(this.buffer)}update(e){Ze(this),Ge(e=ct(e));const{view:t,buffer:r,blockLen:n}=this,o=e.length;for(let i=0;i<o;){const s=Math.min(n-this.pos,o-i);if(s!==n)r.set(e.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===n&&(this.process(t,0),this.pos=0);else{const t=Qe(e);for(;n<=o-i;i+=n)this.process(t,i)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ze(this),Xe(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:n,isLE:o}=this;let{pos:i}=this;t[i++]=128,Ye(this.buffer.subarray(i)),this.padOffset>n-i&&(this.process(r,0),i=0);for(let e=i;e<n;e++)t[e]=0;!function(e,t,r,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,n);const o=BigInt(32),i=BigInt(4294967295),s=Number(r>>o&i),f=Number(r&i),c=n?4:0,a=n?0:4;e.setUint32(t+c,s,n),e.setUint32(t+a,f,n)}(r,n-8,BigInt(8*this.length),o),this.process(r,0);const s=Qe(e),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=f/4,a=this.get();if(c>a.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<c;e++)s.setUint32(4*e,a[e],o)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:n,finished:o,destroyed:i,pos:s}=this;return e.destroyed=i,e.finished=o,e.length=n,e.pos=s,n%t&&e.buffer.set(r),e}clone(){return this._cloneInto()}}const yt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),wt=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),gt=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),bt=BigInt(2**32-1),mt=BigInt(32);function vt(e,t=!1){return t?{h:Number(e&bt),l:Number(e>>mt&bt)}:{h:0|Number(e>>mt&bt),l:0|Number(e&bt)}}function Et(e,t=!1){const r=e.length;let n=new Uint32Array(r),o=new Uint32Array(r);for(let i=0;i<r;i++){const{h:r,l:s}=vt(e[i],t);[n[i],o[i]]=[r,s]}return[n,o]}const xt=(e,t,r)=>e>>>r,At=(e,t,r)=>e<<32-r|t>>>r,Bt=(e,t,r)=>e>>>r|t<<32-r,St=(e,t,r)=>e<<32-r|t>>>r,It=(e,t,r)=>e<<64-r|t>>>r-32,kt=(e,t,r)=>e>>>r-32|t<<64-r;function Ut(e,t,r,n){const o=(t>>>0)+(n>>>0);return{h:e+r+(o/2**32|0)|0,l:0|o}}const Pt=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),Ot=(e,t,r,n)=>t+r+n+(e/2**32|0)|0,Rt=(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0),Tt=(e,t,r,n,o)=>t+r+n+o+(e/2**32|0)|0,Nt=(e,t,r,n,o)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(o>>>0),Ct=(e,t,r,n,o,i)=>t+r+n+o+i+(e/2**32|0)|0,Kt=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Lt=new Uint32Array(64);class Dt extends pt{constructor(e=32){super(64,e,8,!1),this.A=0|yt[0],this.B=0|yt[1],this.C=0|yt[2],this.D=0|yt[3],this.E=0|yt[4],this.F=0|yt[5],this.G=0|yt[6],this.H=0|yt[7]}get(){const{A:e,B:t,C:r,D:n,E:o,F:i,G:s,H:f}=this;return[e,t,r,n,o,i,s,f]}set(e,t,r,n,o,i,s,f){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n,this.E=0|o,this.F=0|i,this.G=0|s,this.H=0|f}process(e,t){for(let r=0;r<16;r++,t+=4)Lt[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=Lt[e-15],r=Lt[e-2],n=et(t,7)^et(t,18)^t>>>3,o=et(r,17)^et(r,19)^r>>>10;Lt[e]=o+Lt[e-7]+n+Lt[e-16]|0}let{A:r,B:n,C:o,D:i,E:s,F:f,G:c,H:a}=this;for(let e=0;e<64;e++){const t=a+(et(s,6)^et(s,11)^et(s,25))+((u=s)&f^~u&c)+Kt[e]+Lt[e]|0,h=(et(r,2)^et(r,13)^et(r,22))+lt(r,n,o)|0;a=c,c=f,f=s,s=i+t|0,i=o,o=n,n=r,r=t+h|0}var u;r=r+this.A|0,n=n+this.B|0,o=o+this.C|0,i=i+this.D|0,s=s+this.E|0,f=f+this.F|0,c=c+this.G|0,a=a+this.H|0,this.set(r,n,o,i,s,f,c,a)}roundClean(){Ye(Lt)}destroy(){this.set(0,0,0,0,0,0,0,0),Ye(this.buffer)}}const $t=(()=>Et(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map((e=>BigInt(e)))))(),jt=(()=>$t[0])(),_t=(()=>$t[1])(),Vt=new Uint32Array(80),Ft=new Uint32Array(80);class Ht extends pt{constructor(e=64){super(128,e,16,!1),this.Ah=0|gt[0],this.Al=0|gt[1],this.Bh=0|gt[2],this.Bl=0|gt[3],this.Ch=0|gt[4],this.Cl=0|gt[5],this.Dh=0|gt[6],this.Dl=0|gt[7],this.Eh=0|gt[8],this.El=0|gt[9],this.Fh=0|gt[10],this.Fl=0|gt[11],this.Gh=0|gt[12],this.Gl=0|gt[13],this.Hh=0|gt[14],this.Hl=0|gt[15]}get(){const{Ah:e,Al:t,Bh:r,Bl:n,Ch:o,Cl:i,Dh:s,Dl:f,Eh:c,El:a,Fh:u,Fl:h,Gh:d,Gl:l,Hh:p,Hl:y}=this;return[e,t,r,n,o,i,s,f,c,a,u,h,d,l,p,y]}set(e,t,r,n,o,i,s,f,c,a,u,h,d,l,p,y){this.Ah=0|e,this.Al=0|t,this.Bh=0|r,this.Bl=0|n,this.Ch=0|o,this.Cl=0|i,this.Dh=0|s,this.Dl=0|f,this.Eh=0|c,this.El=0|a,this.Fh=0|u,this.Fl=0|h,this.Gh=0|d,this.Gl=0|l,this.Hh=0|p,this.Hl=0|y}process(e,t){for(let r=0;r<16;r++,t+=4)Vt[r]=e.getUint32(t),Ft[r]=e.getUint32(t+=4);for(let e=16;e<80;e++){const t=0|Vt[e-15],r=0|Ft[e-15],n=Bt(t,r,1)^Bt(t,r,8)^xt(t,0,7),o=St(t,r,1)^St(t,r,8)^At(t,r,7),i=0|Vt[e-2],s=0|Ft[e-2],f=Bt(i,s,19)^It(i,s,61)^xt(i,0,6),c=St(i,s,19)^kt(i,s,61)^At(i,s,6),a=Rt(o,c,Ft[e-7],Ft[e-16]),u=Tt(a,n,f,Vt[e-7],Vt[e-16]);Vt[e]=0|u,Ft[e]=0|a}let{Ah:r,Al:n,Bh:o,Bl:i,Ch:s,Cl:f,Dh:c,Dl:a,Eh:u,El:h,Fh:d,Fl:l,Gh:p,Gl:y,Hh:w,Hl:g}=this;for(let e=0;e<80;e++){const t=Bt(u,h,14)^Bt(u,h,18)^It(u,h,41),b=St(u,h,14)^St(u,h,18)^kt(u,h,41),m=u&d^~u&p,v=Nt(g,b,h&l^~h&y,_t[e],Ft[e]),E=Ct(v,w,t,m,jt[e],Vt[e]),x=0|v,A=Bt(r,n,28)^It(r,n,34)^It(r,n,39),B=St(r,n,28)^kt(r,n,34)^kt(r,n,39),S=r&o^r&s^o&s,I=n&i^n&f^i&f;w=0|p,g=0|y,p=0|d,y=0|l,d=0|u,l=0|h,({h:u,l:h}=Ut(0|c,0|a,0|E,0|x)),c=0|s,a=0|f,s=0|o,f=0|i,o=0|r,i=0|n;const k=Pt(x,B,I);r=Ot(k,E,A,S),n=0|k}({h:r,l:n}=Ut(0|this.Ah,0|this.Al,0|r,0|n)),({h:o,l:i}=Ut(0|this.Bh,0|this.Bl,0|o,0|i)),({h:s,l:f}=Ut(0|this.Ch,0|this.Cl,0|s,0|f)),({h:c,l:a}=Ut(0|this.Dh,0|this.Dl,0|c,0|a)),({h:u,l:h}=Ut(0|this.Eh,0|this.El,0|u,0|h)),({h:d,l}=Ut(0|this.Fh,0|this.Fl,0|d,0|l)),({h:p,l:y}=Ut(0|this.Gh,0|this.Gl,0|p,0|y)),({h:w,l:g}=Ut(0|this.Hh,0|this.Hl,0|w,0|g)),this.set(r,n,o,i,s,f,c,a,u,h,d,l,p,y,w,g)}roundClean(){Ye(Vt,Ft)}destroy(){Ye(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class zt extends Ht{constructor(){super(48),this.Ah=0|wt[0],this.Al=0|wt[1],this.Bh=0|wt[2],this.Bl=0|wt[3],this.Ch=0|wt[4],this.Cl=0|wt[5],this.Dh=0|wt[6],this.Dl=0|wt[7],this.Eh=0|wt[8],this.El=0|wt[9],this.Fh=0|wt[10],this.Fl=0|wt[11],this.Gh=0|wt[12],this.Gl=0|wt[13],this.Hh=0|wt[14],this.Hl=0|wt[15]}}const Jt=ht((()=>new Dt)),Mt=ht((()=>new Ht)),Wt=ht((()=>new zt)),qt=BigInt(0),Gt=BigInt(1);function Zt(e,t){if("boolean"!=typeof t)throw new Error(e+" boolean expected, got "+t)}function Xt(e){const t=e.toString(16);return 1&t.length?"0"+t:t}function Yt(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return""===e?qt:BigInt("0x"+e)}function Qt(e){return Yt(it(e))}function er(e){return Ge(e),Yt(it(Uint8Array.from(e).reverse()))}function tr(e,t){return ft(e.toString(16).padStart(2*t,"0"))}function rr(e,t){return tr(e,t).reverse()}function nr(e,t,r){let n;if("string"==typeof t)try{n=ft(t)}catch(t){throw new Error(e+" must be hex string or Uint8Array, cause: "+t)}else{if(!We(t))throw new Error(e+" must be hex string or Uint8Array");n=Uint8Array.from(t)}const o=n.length;if("number"==typeof r&&o!==r)throw new Error(e+" of length "+r+" expected, got "+o);return n}const or=e=>"bigint"==typeof e&&qt<=e;function ir(e,t,r,n){if(!function(e,t,r){return or(e)&&or(t)&&or(r)&&t<=e&&e<r}(t,r,n))throw new Error("expected valid "+e+": "+r+" <= n < "+n+", got "+t)}const sr=e=>(Gt<<BigInt(e))-Gt;function fr(e,t,r={}){if(!e||"object"!=typeof e)throw new Error("expected valid options object");function n(t,r,n){const o=e[t];if(n&&void 0===o)return;const i=typeof o;if(i!==r||null===o)throw new Error(`param "${t}" is invalid: expected ${r}, got ${i}`)}Object.entries(t).forEach((([e,t])=>n(e,t,!1))),Object.entries(r).forEach((([e,t])=>n(e,t,!0)))}function cr(e){const t=new WeakMap;return(r,...n)=>{const o=t.get(r);if(void 0!==o)return o;const i=e(r,...n);return t.set(r,i),i}}const ar=BigInt(0),ur=BigInt(1),hr=BigInt(2),dr=BigInt(3),lr=BigInt(4),pr=BigInt(5),yr=BigInt(8);function wr(e,t){const r=e%t;return r>=ar?r:t+r}function gr(e,t,r){let n=e;for(;t-- >ar;)n*=n,n%=r;return n}function br(e,t){if(e===ar)throw new Error("invert: expected non-zero number");if(t<=ar)throw new Error("invert: expected positive modulus, got "+t);let r=wr(e,t),n=t,o=ar,i=ur,s=ur,f=ar;for(;r!==ar;){const e=n/r,t=n%r,c=o-s*e,a=i-f*e;n=r,r=t,o=s,i=f,s=c,f=a}if(n!==ur)throw new Error("invert: does not exist");return wr(o,t)}function mr(e,t){const r=(e.ORDER+ur)/lr,n=e.pow(t,r);if(!e.eql(e.sqr(n),t))throw new Error("Cannot find square root");return n}function vr(e,t){const r=(e.ORDER-pr)/yr,n=e.mul(t,hr),o=e.pow(n,r),i=e.mul(t,o),s=e.mul(e.mul(i,hr),o),f=e.mul(i,e.sub(s,e.ONE));if(!e.eql(e.sqr(f),t))throw new Error("Cannot find square root");return f}const Er=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function xr(e,t,r=!1){const n=new Array(t.length).fill(r?e.ZERO:void 0),o=t.reduce(((t,r,o)=>e.is0(r)?t:(n[o]=t,e.mul(t,r))),e.ONE),i=e.inv(o);return t.reduceRight(((t,r,o)=>e.is0(r)?t:(n[o]=e.mul(t,n[o]),e.mul(t,r))),i),n}function Ar(e,t){const r=(e.ORDER-ur)/hr,n=e.pow(t,r),o=e.eql(n,e.ONE),i=e.eql(n,e.ZERO),s=e.eql(n,e.neg(e.ONE));if(!o&&!i&&!s)throw new Error("invalid Legendre symbol result");return o?1:i?0:-1}function Br(e,t,r=!1,n={}){if(e<=ar)throw new Error("invalid field: expected ORDER > 0, got "+e);let o,i;if("object"==typeof t&&null!=t){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");const e=t;e.BITS&&(o=e.BITS),e.sqrt&&(i=e.sqrt),"boolean"==typeof e.isLE&&(r=e.isLE)}else"number"==typeof t&&(o=t),n.sqrt&&(i=n.sqrt);const{nBitLength:s,nByteLength:f}=function(e,t){void 0!==t&&qe(t);const r=void 0!==t?t:e.toString(2).length;return{nBitLength:r,nByteLength:Math.ceil(r/8)}}(e,o);if(f>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let c;const a=Object.freeze({ORDER:e,isLE:r,BITS:s,BYTES:f,MASK:sr(s),ZERO:ar,ONE:ur,create:t=>wr(t,e),isValid:t=>{if("bigint"!=typeof t)throw new Error("invalid field element: expected bigint, got "+typeof t);return ar<=t&&t<e},is0:e=>e===ar,isValidNot0:e=>!a.is0(e)&&a.isValid(e),isOdd:e=>(e&ur)===ur,neg:t=>wr(-t,e),eql:(e,t)=>e===t,sqr:t=>wr(t*t,e),add:(t,r)=>wr(t+r,e),sub:(t,r)=>wr(t-r,e),mul:(t,r)=>wr(t*r,e),pow:(e,t)=>function(e,t,r){if(r<ar)throw new Error("invalid exponent, negatives unsupported");if(r===ar)return e.ONE;if(r===ur)return t;let n=e.ONE,o=t;for(;r>ar;)r&ur&&(n=e.mul(n,o)),o=e.sqr(o),r>>=ur;return n}(a,e,t),div:(t,r)=>wr(t*br(r,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>br(t,e),sqrt:i||(t=>{return c||(c=(r=e)%lr===dr?mr:r%yr===pr?vr:function(e){if(e<BigInt(3))throw new Error("sqrt is not defined for small field");let t=e-ur,r=0;for(;t%hr===ar;)t/=hr,r++;let n=hr;const o=Br(e);for(;1===Ar(o,n);)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(1===r)return mr;let i=o.pow(n,t);const s=(t+ur)/hr;return function(e,n){if(e.is0(n))return n;if(1!==Ar(e,n))throw new Error("Cannot find square root");let o=r,f=e.mul(e.ONE,i),c=e.pow(n,t),a=e.pow(n,s);for(;!e.eql(c,e.ONE);){if(e.is0(c))return e.ZERO;let t=1,r=e.sqr(c);for(;!e.eql(r,e.ONE);)if(t++,r=e.sqr(r),t===o)throw new Error("Cannot find square root");const n=ur<<BigInt(o-t-1),i=e.pow(f,n);o=t,f=e.sqr(i),c=e.mul(c,f),a=e.mul(a,i)}return a}}(r)),c(a,t);var r}),toBytes:e=>r?rr(e,f):tr(e,f),fromBytes:e=>{if(e.length!==f)throw new Error("Field.fromBytes: expected "+f+" bytes, got "+e.length);return r?er(e):Qt(e)},invertBatch:e=>xr(a,e),cmov:(e,t,r)=>r?t:e});return Object.freeze(a)}function Sr(e){if("bigint"!=typeof e)throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function Ir(e){const t=Sr(e);return t+Math.ceil(t/2)}const kr=BigInt(0),Ur=BigInt(1);function Pr(e,t){const r=t.negate();return e?r:t}function Or(e,t,r){const n="pz"===t?e=>e.pz:e=>e.ez,o=xr(e.Fp,r.map(n));return r.map(((e,t)=>e.toAffine(o[t]))).map(e.fromAffine)}function Rr(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function Tr(e,t){Rr(e,t);const r=2**e;return{windows:Math.ceil(t/e)+1,windowSize:2**(e-1),mask:sr(e),maxNumber:r,shiftBy:BigInt(e)}}function Nr(e,t,r){const{windowSize:n,mask:o,maxNumber:i,shiftBy:s}=r;let f=Number(e&o),c=e>>s;f>n&&(f-=i,c+=Ur);const a=t*n;return{nextN:c,offset:a+Math.abs(f)-1,isZero:0===f,isNeg:f<0,isNegF:t%2!=0,offsetF:a}}const Cr=new WeakMap,Kr=new WeakMap;function Lr(e){return Kr.get(e)||1}function Dr(e){if(e!==kr)throw new Error("invalid wNAF")}function $r(e,t){return{constTimeNegate:Pr,hasPrecomputes:e=>1!==Lr(e),unsafeLadder(t,r,n=e.ZERO){let o=t;for(;r>kr;)r&Ur&&(n=n.add(o)),o=o.double(),r>>=Ur;return n},precomputeWindow(e,r){const{windows:n,windowSize:o}=Tr(r,t),i=[];let s=e,f=s;for(let e=0;e<n;e++){f=s,i.push(f);for(let e=1;e<o;e++)f=f.add(s),i.push(f);s=f.double()}return i},wNAF(r,n,o){let i=e.ZERO,s=e.BASE;const f=Tr(r,t);for(let e=0;e<f.windows;e++){const{nextN:t,offset:r,isZero:c,isNeg:a,isNegF:u,offsetF:h}=Nr(o,e,f);o=t,c?s=s.add(Pr(u,n[h])):i=i.add(Pr(a,n[r]))}return Dr(o),{p:i,f:s}},wNAFUnsafe(r,n,o,i=e.ZERO){const s=Tr(r,t);for(let e=0;e<s.windows&&o!==kr;e++){const{nextN:t,offset:r,isZero:f,isNeg:c}=Nr(o,e,s);if(o=t,!f){const e=n[r];i=i.add(c?e.negate():e)}}return Dr(o),i},getPrecomputes(e,t,r){let n=Cr.get(t);return n||(n=this.precomputeWindow(t,e),1!==e&&("function"==typeof r&&(n=r(n)),Cr.set(t,n))),n},wNAFCached(e,t,r){const n=Lr(e);return this.wNAF(n,this.getPrecomputes(n,e,r),t)},wNAFCachedUnsafe(e,t,r,n){const o=Lr(e);return 1===o?this.unsafeLadder(e,t,n):this.wNAFUnsafe(o,this.getPrecomputes(o,e,r),t,n)},setWindowSize(e,r){Rr(r,t),Kr.set(e,r),Cr.delete(e)}}}function jr(e,t,r,n){(function(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach(((e,r)=>{if(!(e instanceof t))throw new Error("invalid point at index "+r)}))})(r,e),function(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach(((e,r)=>{if(!t.isValid(e))throw new Error("invalid scalar at index "+r)}))}(n,t);const o=r.length,i=n.length;if(o!==i)throw new Error("arrays of points and scalars must have equal length");const s=e.ZERO,f=function(e){let t;for(t=0;e>qt;e>>=Gt,t+=1);return t}(BigInt(o));let c=1;f>12?c=f-3:f>4?c=f-2:f>0&&(c=2);const a=sr(c),u=new Array(Number(a)+1).fill(s);let h=s;for(let e=Math.floor((t.BITS-1)/c)*c;e>=0;e-=c){u.fill(s);for(let t=0;t<i;t++){const o=n[t],i=Number(o>>BigInt(e)&a);u[i]=u[i].add(r[t])}let t=s;for(let e=u.length-1,r=s;e>0;e--)r=r.add(u[e]),t=t.add(r);if(h=h.add(t),0!==e)for(let e=0;e<c;e++)h=h.double()}return h}function _r(e,t){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return function(e){fr(e,Er.reduce(((e,t)=>(e[t]="function",e)),{ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"}))}(t),t}return Br(e)}function Vr(e,t,r={}){if(!t||"object"!=typeof t)throw new Error(`expected valid ${e} CURVE object`);for(const e of["p","n","h"]){const r=t[e];if(!("bigint"==typeof r&&r>kr))throw new Error(`CURVE.${e} must be positive bigint`)}const n=_r(t.p,r.Fp),o=_r(t.n,r.Fn),i=["Gx","Gy","a","weierstrass"===e?"b":"d"];for(const e of i)if(!n.isValid(t[e]))throw new Error(`CURVE.${e} must be valid field element of CURVE.Fp`);return{Fp:n,Fn:o}}const Fr=BigInt(0),Hr=BigInt(1),zr=BigInt(2),Jr=BigInt(8),Mr={zip215:!0};function Wr(e){const{CURVE:t,curveOpts:r,eddsaOpts:n}=function(e){const t={a:e.a,d:e.d,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy};return{CURVE:t,curveOpts:{Fp:e.Fp,Fn:Br(t.n,e.nBitLength,!0),uvRatio:e.uvRatio},eddsaOpts:{hash:e.hash,randomBytes:e.randomBytes,adjustScalarBytes:e.adjustScalarBytes,domain:e.domain,prehash:e.prehash,mapToCurve:e.mapToCurve}}}(e),o=function(e,t={}){const{Fp:r,Fn:n}=Vr("edwards",e,t),{h:o,n:i}=e;fr(t,{},{uvRatio:"function"});const s=zr<<BigInt(8*n.BYTES)-Hr,f=e=>r.create(e),c=t.uvRatio||((e,t)=>{try{return{isValid:!0,value:r.sqrt(r.div(e,t))}}catch(e){return{isValid:!1,value:Fr}}});if(!function(e,t,r,n){const o=e.sqr(r),i=e.sqr(n),s=e.add(e.mul(t.a,o),i),f=e.add(e.ONE,e.mul(t.d,e.mul(o,i)));return e.eql(s,f)}(r,e,e.Gx,e.Gy))throw new Error("bad curve params: generator point");function a(e,t,r=!1){return ir("coordinate "+e,t,r?Hr:Fr,s),t}function u(e){if(!(e instanceof l))throw new Error("ExtendedPoint expected")}const h=cr(((e,t)=>{const{ex:n,ey:o,ez:i}=e,s=e.is0();null==t&&(t=s?Jr:r.inv(i));const c=f(n*t),a=f(o*t),u=f(i*t);if(s)return{x:Fr,y:Hr};if(u!==Hr)throw new Error("invZ was invalid");return{x:c,y:a}})),d=cr((t=>{const{a:r,d:n}=e;if(t.is0())throw new Error("bad point: ZERO");const{ex:o,ey:i,ez:s,et:c}=t,a=f(o*o),u=f(i*i),h=f(s*s),d=f(h*h),l=f(a*r);if(f(h*f(l+u))!==f(d+f(n*f(a*u))))throw new Error("bad point: equation left != right (1)");if(f(o*i)!==f(s*c))throw new Error("bad point: equation left != right (2)");return!0}));class l{constructor(e,t,r,n){this.ex=a("x",e),this.ey=a("y",t),this.ez=a("z",r,!0),this.et=a("t",n),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(e){if(e instanceof l)throw new Error("extended point not allowed");const{x:t,y:r}=e||{};return a("x",t),a("y",r),new l(t,r,Hr,f(t*r))}static normalizeZ(e){return Or(l,"ez",e)}static msm(e,t){return jr(l,n,e,t)}_setWindowSize(e){this.precompute(e)}precompute(e=8,t=!0){return p.setWindowSize(this,e),t||this.multiply(zr),this}assertValidity(){d(this)}equals(e){u(e);const{ex:t,ey:r,ez:n}=this,{ex:o,ey:i,ez:s}=e,c=f(t*s),a=f(o*n),h=f(r*s),d=f(i*n);return c===a&&h===d}is0(){return this.equals(l.ZERO)}negate(){return new l(f(-this.ex),this.ey,this.ez,f(-this.et))}double(){const{a:t}=e,{ex:r,ey:n,ez:o}=this,i=f(r*r),s=f(n*n),c=f(zr*f(o*o)),a=f(t*i),u=r+n,h=f(f(u*u)-i-s),d=a+s,p=d-c,y=a-s,w=f(h*p),g=f(d*y),b=f(h*y),m=f(p*d);return new l(w,g,m,b)}add(t){u(t);const{a:r,d:n}=e,{ex:o,ey:i,ez:s,et:c}=this,{ex:a,ey:h,ez:d,et:p}=t,y=f(o*a),w=f(i*h),g=f(c*n*p),b=f(s*d),m=f((o+i)*(a+h)-y-w),v=b-g,E=b+g,x=f(w-r*y),A=f(m*v),B=f(E*x),S=f(m*x),I=f(v*E);return new l(A,B,I,S)}subtract(e){return this.add(e.negate())}multiply(e){const t=e;ir("scalar",t,Hr,i);const{p:r,f:n}=p.wNAFCached(this,t,l.normalizeZ);return l.normalizeZ([r,n])[0]}multiplyUnsafe(e,t=l.ZERO){const r=e;return ir("scalar",r,Fr,i),r===Fr?l.ZERO:this.is0()||r===Hr?this:p.wNAFCachedUnsafe(this,r,l.normalizeZ,t)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}isTorsionFree(){return p.wNAFCachedUnsafe(this,i).is0()}toAffine(e){return h(this,e)}clearCofactor(){return o===Hr?this:this.multiplyUnsafe(o)}static fromBytes(e,t=!1){return Ge(e),this.fromHex(e,t)}static fromHex(t,n=!1){const{d:o,a:i}=e,a=r.BYTES;t=nr("pointHex",t,a),Zt("zip215",n);const u=t.slice(),h=t[a-1];u[a-1]=-129&h;const d=er(u),p=n?s:r.ORDER;ir("pointHex.y",d,Fr,p);const y=f(d*d),w=f(y-Hr),g=f(o*y-i);let{isValid:b,value:m}=c(w,g);if(!b)throw new Error("Point.fromHex: invalid y coordinate");const v=(m&Hr)===Hr,E=!!(128&h);if(!n&&m===Fr&&E)throw new Error("Point.fromHex: x=0 and x_0=1");return E!==v&&(m=f(-m)),l.fromAffine({x:m,y:d})}static fromPrivateScalar(e){return l.BASE.multiply(e)}toBytes(){const{x:e,y:t}=this.toAffine(),n=rr(t,r.BYTES);return n[n.length-1]|=e&Hr?128:0,n}toRawBytes(){return this.toBytes()}toHex(){return it(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}l.BASE=new l(e.Gx,e.Gy,Hr,f(e.Gx*e.Gy)),l.ZERO=new l(Fr,Hr,Hr,Fr),l.Fp=r,l.Fn=n;const p=$r(l,8*n.BYTES);return l}(t,r);return function(e,t){return Object.assign({},t,{ExtendedPoint:t.Point,CURVE:e})}(e,function(e,t){fr(t,{hash:"function"},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});const{prehash:r,hash:n}=t,{BASE:o,Fp:i,Fn:s}=e,f=s.ORDER,c=t.randomBytes||dt,a=t.adjustScalarBytes||(e=>e),u=t.domain||((e,t,r)=>{if(Zt("phflag",r),t.length||r)throw new Error("Contexts/pre-hash are not supported");return e});function h(e){return s.create(e)}function d(e){return h(er(e))}function l(e){const{head:t,prefix:r,scalar:s}=function(e){const t=i.BYTES;e=nr("private key",e,t);const r=nr("hashed private key",n(e),2*t),o=a(r.slice(0,t));return{head:o,prefix:r.slice(t,2*t),scalar:d(o)}}(e),f=o.multiply(s),c=f.toBytes();return{head:t,prefix:r,scalar:s,point:f,pointBytes:c}}function p(e=Uint8Array.of(),...t){const o=at(...t);return d(n(u(o,nr("context",e),!!r)))}const y=Mr;return o.precompute(8),{getPublicKey:function(e){return l(e).pointBytes},sign:function(e,t,n={}){e=nr("message",e),r&&(e=r(e));const{prefix:s,scalar:c,pointBytes:a}=l(t),u=p(n.context,s,e),d=o.multiply(u).toBytes(),y=h(u+p(n.context,d,a,e)*c);ir("signature.s",y,Fr,f);const w=i.BYTES;return nr("result",at(d,rr(y,w)),2*w)},verify:function(t,n,s,f=y){const{context:c,zip215:a}=f,u=i.BYTES;t=nr("signature",t,2*u),n=nr("message",n),s=nr("publicKey",s,u),void 0!==a&&Zt("zip215",a),r&&(n=r(n));const h=er(t.slice(u,2*u));let d,l,w;try{d=e.fromHex(s,a),l=e.fromHex(t.slice(0,u),a),w=o.multiplyUnsafe(h)}catch(e){return!1}if(!a&&d.isSmallOrder())return!1;const g=p(c,l.toBytes(),d.toBytes(),n);return l.add(d.multiplyUnsafe(g)).subtract(w).clearCofactor().is0()},utils:{getExtendedPublicKey:l,randomPrivateKey:()=>c(i.BYTES),precompute:(t=8,r=e.BASE)=>r.precompute(t,!1)},Point:e}}(o,n))}const qr=BigInt(0),Gr=BigInt(1),Zr=BigInt(2);BigInt(0);const Xr=BigInt(1),Yr=BigInt(2),Qr=BigInt(3),en=BigInt(5),tn=BigInt(8),rn={p:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:tn,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function nn(e){const t=BigInt(10),r=BigInt(20),n=BigInt(40),o=BigInt(80),i=rn.p,s=e*e%i*e%i,f=gr(s,Yr,i)*s%i,c=gr(f,Xr,i)*e%i,a=gr(c,en,i)*c%i,u=gr(a,t,i)*a%i,h=gr(u,r,i)*u%i,d=gr(h,n,i)*h%i,l=gr(d,o,i)*d%i,p=gr(l,o,i)*d%i,y=gr(p,t,i)*a%i;return{pow_p_5_8:gr(y,Yr,i)*e%i,b2:s}}function on(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}const sn=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function fn(e,t){const r=rn.p,n=wr(t*t*t,r),o=wr(n*n*t,r);let i=wr(e*n*nn(e*o).pow_p_5_8,r);const s=wr(t*i*i,r),f=i,c=wr(i*sn,r),a=s===e,u=s===wr(-e,r),h=s===wr(-e*sn,r);return a&&(i=f),(u||h)&&(i=c),(wr(i,r)&ur)===ur&&(i=wr(-i,r)),{isValid:a||u,value:i}}const cn=(()=>Br(rn.p,void 0,!0))(),an=(()=>({...rn,Fp:cn,hash:Mt,adjustScalarBytes:on,uvRatio:fn}))(),un=(()=>Wr(an))(),hn=(()=>{const e=rn.p;return function(e){const t=(fr(r=e,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...r}));var r;const{P:n,type:o,adjustScalarBytes:i,powPminus2:s,randomBytes:f}=t,c="x25519"===o;if(!c&&"x448"!==o)throw new Error("invalid type");const a=f||dt,u=c?255:448,h=c?32:56,d=c?BigInt(9):BigInt(5),l=c?BigInt(121665):BigInt(39081),p=c?Zr**BigInt(254):Zr**BigInt(447),y=c?BigInt(8)*Zr**BigInt(251)-Gr:BigInt(4)*Zr**BigInt(445)-Gr,w=p+y+Gr,g=e=>wr(e,n),b=m(d);function m(e){return rr(g(e),h)}function v(e,t){const r=function(e,t){ir("u",e,qr,n),ir("scalar",t,p,w);const r=t,o=e;let i=Gr,f=qr,c=e,a=Gr,h=qr;for(let e=BigInt(u-1);e>=qr;e--){const t=r>>e&Gr;h^=t,({x_2:i,x_3:c}=x(h,i,c)),({x_2:f,x_3:a}=x(h,f,a)),h=t;const n=i+f,s=g(n*n),u=i-f,d=g(u*u),p=s-d,y=c+a,w=g((c-a)*n),b=g(y*u),m=w+b,v=w-b;c=g(m*m),a=g(o*g(v*v)),i=g(s*d),f=g(p*(s+g(l*p)))}({x_2:i,x_3:c}=x(h,i,c)),({x_2:f,x_3:a}=x(h,f,a));const d=s(f);return g(i*d)}(function(e){const t=nr("u coordinate",e,h);return c&&(t[31]&=127),g(er(t))}(t),function(e){return er(i(nr("scalar",e,h)))}(e));if(r===qr)throw new Error("invalid private or public key received");return m(r)}function E(e){return v(e,b)}function x(e,t,r){const n=g(e*(t-r));return{x_2:t=g(t-n),x_3:r=g(r+n)}}return{scalarMult:v,scalarMultBase:E,getSharedSecret:(e,t)=>v(e,t),getPublicKey:e=>E(e),utils:{randomPrivateKey:()=>a(h)},GuBytes:b.slice()}}({P:e,type:"x25519",powPminus2:t=>{const{pow_p_5_8:r,b2:n}=nn(t);return wr(gr(r,Qr,e)*n,e)},adjustScalarBytes:on})})();var dn=r(466);class ln extends ut{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,function(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.createHasher");qe(e.outputLen),qe(e.blockLen)}(e);const r=ct(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const n=this.blockLen,o=new Uint8Array(n);o.set(r.length>n?e.create().update(r).digest():r);for(let e=0;e<o.length;e++)o[e]^=54;this.iHash.update(o),this.oHash=e.create();for(let e=0;e<o.length;e++)o[e]^=106;this.oHash.update(o),Ye(o)}update(e){return Ze(this),this.iHash.update(e),this}digestInto(e){Ze(this),Ge(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:n,destroyed:o,blockLen:i,outputLen:s}=this;return e.finished=n,e.destroyed=o,e.blockLen=i,e.outputLen=s,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const pn=(e,t,r)=>new ln(e,t).update(r).digest();function yn(e){void 0!==e.lowS&&Zt("lowS",e.lowS),void 0!==e.prehash&&Zt("prehash",e.prehash)}pn.create=(e,t)=>new ln(e,t);class wn extends Error{constructor(e=""){super(e)}}const gn={Err:wn,_tlv:{encode:(e,t)=>{const{Err:r}=gn;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(1&t.length)throw new r("tlv.encode: unpadded data");const n=t.length/2,o=Xt(n);if(o.length/2&128)throw new r("tlv.encode: long form length too big");const i=n>127?Xt(o.length/2|128):"";return Xt(e)+i+o+t},decode(e,t){const{Err:r}=gn;let n=0;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length<2||t[n++]!==e)throw new r("tlv.decode: wrong tlv");const o=t[n++];let i=0;if(128&o){const e=127&o;if(!e)throw new r("tlv.decode(long): indefinite length not supported");if(e>4)throw new r("tlv.decode(long): byte length is too big");const s=t.subarray(n,n+e);if(s.length!==e)throw new r("tlv.decode: length bytes not complete");if(0===s[0])throw new r("tlv.decode(long): zero leftmost byte");for(const e of s)i=i<<8|e;if(n+=e,i<128)throw new r("tlv.decode(long): not minimal encoding")}else i=o;const s=t.subarray(n,n+i);if(s.length!==i)throw new r("tlv.decode: wrong value length");return{v:s,l:t.subarray(n+i)}}},_int:{encode(e){const{Err:t}=gn;if(e<bn)throw new t("integer: negative integers are not allowed");let r=Xt(e);if(8&Number.parseInt(r[0],16)&&(r="00"+r),1&r.length)throw new t("unexpected DER parsing assertion: unpadded hex");return r},decode(e){const{Err:t}=gn;if(128&e[0])throw new t("invalid signature integer: negative");if(0===e[0]&&!(128&e[1]))throw new t("invalid signature integer: unnecessary leading zero");return Qt(e)}},toSig(e){const{Err:t,_int:r,_tlv:n}=gn,o=nr("signature",e),{v:i,l:s}=n.decode(48,o);if(s.length)throw new t("invalid signature: left bytes after parsing");const{v:f,l:c}=n.decode(2,i),{v:a,l:u}=n.decode(2,c);if(u.length)throw new t("invalid signature: left bytes after parsing");return{r:r.decode(f),s:r.decode(a)}},hexFromSig(e){const{_tlv:t,_int:r}=gn,n=t.encode(2,r.encode(e.r))+t.encode(2,r.encode(e.s));return t.encode(48,n)}},bn=BigInt(0),mn=BigInt(1),vn=BigInt(2),En=BigInt(3),xn=BigInt(4);function An(e,t,r){const{BYTES:n}=e;return function(o){let i;if("bigint"==typeof o)i=o;else{let r=nr("private key",o);if(t){if(!t.includes(2*r.length))throw new Error("invalid private key");const e=new Uint8Array(n);e.set(r,e.length-r.length),r=e}try{i=e.fromBytes(r)}catch(e){throw new Error(`invalid private key: expected ui8a of size ${n}, got ${typeof o}`)}}if(r&&(i=e.create(i)),!e.isValidNot0(i))throw new Error("invalid private key: out of range [1..N-1]");return i}}function Bn(e){return Uint8Array.of(e?2:3)}function Sn(e,t,r={}){fr(t,{hash:"function"},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const n=t.randomBytes||dt,o=t.hmac||((e,...r)=>pn(t.hash,e,at(...r))),{Fp:i,Fn:s}=e,{ORDER:f,BITS:c}=s;function a(e){return e>f>>mn}function u(e,t){if(!s.isValidNot0(t))throw new Error(`invalid signature ${e}: out of range 1..CURVE.n`)}class h{constructor(e,t,r){u("r",e),u("s",t),this.r=e,this.s=t,null!=r&&(this.recovery=r),Object.freeze(this)}static fromCompact(e){const t=s.BYTES,r=nr("compactSignature",e,2*t);return new h(s.fromBytes(r.subarray(0,t)),s.fromBytes(r.subarray(t,2*t)))}static fromDER(e){const{r:t,s:r}=gn.toSig(nr("DER",e));return new h(t,r)}assertValidity(){}addRecoveryBit(e){return new h(this.r,this.s,e)}recoverPublicKey(t){const r=i.ORDER,{r:n,s:o,recovery:c}=this;if(null==c||![0,1,2,3].includes(c))throw new Error("recovery id invalid");if(f*vn<r&&c>1)throw new Error("recovery id is ambiguous for h>1 curve");const a=2===c||3===c?n+f:n;if(!i.isValid(a))throw new Error("recovery id 2 or 3 invalid");const u=i.toBytes(a),h=e.fromHex(at(Bn(!(1&c)),u)),d=s.inv(a),l=w(nr("msgHash",t)),p=s.create(-l*d),y=s.create(o*d),g=e.BASE.multiplyUnsafe(p).add(h.multiplyUnsafe(y));if(g.is0())throw new Error("point at infinify");return g.assertValidity(),g}hasHighS(){return a(this.s)}normalizeS(){return this.hasHighS()?new h(this.r,s.neg(this.s),this.recovery):this}toBytes(e){if("compact"===e)return at(s.toBytes(this.r),s.toBytes(this.s));if("der"===e)return ft(gn.hexFromSig(this));throw new Error("invalid format")}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return it(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return it(this.toBytes("compact"))}}const d=An(s,r.allowedPrivateKeyLengths,r.wrapPrivateKey),l={isValidPrivateKey(e){try{return d(e),!0}catch(e){return!1}},normPrivateKeyToScalar:d,randomPrivateKey:()=>{const e=f;return function(e,t,r=!1){const n=e.length,o=Sr(t),i=Ir(t);if(n<16||n<i||n>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+n);const s=wr(r?er(e):Qt(e),t-ur)+ur;return r?rr(s,o):tr(s,o)}(n(Ir(e)),e)},precompute:(t=8,r=e.BASE)=>r.precompute(t,!1)};function p(t){if("bigint"==typeof t)return!1;if(t instanceof e)return!0;const n=nr("key",t).length,o=i.BYTES,f=o+1,c=2*o+1;return r.allowedPrivateKeyLengths||s.BYTES===f?void 0:n===f||n===c}const y=t.bits2int||function(e){if(e.length>8192)throw new Error("input is too large");const t=Qt(e),r=8*e.length-c;return r>0?t>>BigInt(r):t},w=t.bits2int_modN||function(e){return s.create(y(e))},g=sr(c);function b(e){return ir("num < 2^"+c,e,bn,g),s.toBytes(e)}const m={lowS:t.lowS,prehash:!1},v={lowS:t.lowS,prehash:!1};return e.BASE.precompute(8),Object.freeze({getPublicKey:function(t,r=!0){return e.fromPrivateKey(t).toBytes(r)},getSharedSecret:function(t,r,n=!0){if(!0===p(t))throw new Error("first arg must be private key");if(!1===p(r))throw new Error("second arg must be public key");return e.fromHex(r).multiply(d(t)).toBytes(n)},sign:function(r,f,c=m){const{seed:u,k2sig:l}=function(r,o,f=m){if(["recovered","canonical"].some((e=>e in f)))throw new Error("sign() legacy options not supported");const{hash:c}=t;let{lowS:u,prehash:l,extraEntropy:p}=f;null==u&&(u=!0),r=nr("msgHash",r),yn(f),l&&(r=nr("prehashed msgHash",c(r)));const g=w(r),v=d(o),E=[b(v),b(g)];if(null!=p&&!1!==p){const e=!0===p?n(i.BYTES):p;E.push(nr("extraEntropy",e))}const x=at(...E),A=g;return{seed:x,k2sig:function(t){const r=y(t);if(!s.isValidNot0(r))return;const n=s.inv(r),o=e.BASE.multiply(r).toAffine(),i=s.create(o.x);if(i===bn)return;const f=s.create(n*s.create(A+i*v));if(f===bn)return;let c=(o.x===i?0:2)|Number(o.y&mn),d=f;return u&&a(f)&&(d=function(e){return a(e)?s.neg(e):e}(f),c^=1),new h(i,d,c)}}}(r,f,c),p=function(e,t,r){if("number"!=typeof e||e<2)throw new Error("hashLen must be a number");if("number"!=typeof t||t<2)throw new Error("qByteLen must be a number");if("function"!=typeof r)throw new Error("hmacFn must be a function");const n=e=>new Uint8Array(e),o=e=>Uint8Array.of(e);let i=n(e),s=n(e),f=0;const c=()=>{i.fill(1),s.fill(0),f=0},a=(...e)=>r(s,i,...e),u=(e=n(0))=>{s=a(o(0),e),i=a(),0!==e.length&&(s=a(o(1),e),i=a())},h=()=>{if(f++>=1e3)throw new Error("drbg: tried 1000 values");let e=0;const r=[];for(;e<t;){i=a();const t=i.slice();r.push(t),e+=i.length}return at(...r)};return(e,t)=>{let r;for(c(),u(e);!(r=t(h()));)u();return c(),r}}(t.hash.outputLen,s.BYTES,o);return p(u,l)},verify:function(r,n,o,i=v){const f=r;n=nr("msgHash",n),o=nr("publicKey",o),yn(i);const{lowS:c,prehash:a,format:u}=i;if("strict"in i)throw new Error("options.strict was renamed to lowS");if(void 0!==u&&!["compact","der","js"].includes(u))throw new Error('format must be "compact", "der" or "js"');const d="string"==typeof f||We(f),l=!d&&!u&&"object"==typeof f&&null!==f&&"bigint"==typeof f.r&&"bigint"==typeof f.s;if(!d&&!l)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let p,y;try{if(l){if(void 0!==u&&"js"!==u)throw new Error("invalid format");p=new h(f.r,f.s)}if(d){try{"compact"!==u&&(p=h.fromDER(f))}catch(e){if(!(e instanceof gn.Err))throw e}p||"der"===u||(p=h.fromCompact(f))}y=e.fromHex(o)}catch(e){return!1}if(!p)return!1;if(c&&p.hasHighS())return!1;a&&(n=t.hash(n));const{r:g,s:b}=p,m=w(n),E=s.inv(b),x=s.create(m*E),A=s.create(g*E),B=e.BASE.multiplyUnsafe(x).add(y.multiplyUnsafe(A));return!B.is0()&&s.create(B.x)===g},utils:l,Point:e,Signature:h})}function In(e){const{CURVE:t,curveOpts:r,ecdsaOpts:n}=function(e){const{CURVE:t,curveOpts:r}=function(e){const t={a:e.a,b:e.b,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy};return{CURVE:t,curveOpts:{Fp:e.Fp,Fn:Br(t.n,e.nBitLength),allowedPrivateKeyLengths:e.allowedPrivateKeyLengths,allowInfinityPoint:e.allowInfinityPoint,endo:e.endo,wrapPrivateKey:e.wrapPrivateKey,isTorsionFree:e.isTorsionFree,clearCofactor:e.clearCofactor,fromBytes:e.fromBytes,toBytes:e.toBytes}}}(e);return{CURVE:t,curveOpts:r,ecdsaOpts:{hash:e.hash,hmac:e.hmac,randomBytes:e.randomBytes,lowS:e.lowS,bits2int:e.bits2int,bits2int_modN:e.bits2int_modN}}}(e);return function(e,t){return Object.assign({},t,{ProjectivePoint:t.Point,CURVE:e})}(e,Sn(function(e,t={}){const{Fp:r,Fn:n}=Vr("weierstrass",e,t),{h:o,n:i}=e;fr(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:s}=t;if(s&&(!r.is0(e.a)||"bigint"!=typeof s.beta||"function"!=typeof s.splitScalar))throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function');function f(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}const c=t.toBytes||function(e,t,n){const{x:o,y:i}=t.toAffine(),s=r.toBytes(o);return Zt("isCompressed",n),n?(f(),at(Bn(!r.isOdd(i)),s)):at(Uint8Array.of(4),s,r.toBytes(i))},a=t.fromBytes||function(e){Ge(e);const t=r.BYTES,n=t+1,o=2*t+1,i=e.length,s=e[0],c=e.subarray(1);if(i!==n||2!==s&&3!==s){if(i===o&&4===s){const e=r.fromBytes(c.subarray(0*t,1*t)),n=r.fromBytes(c.subarray(1*t,2*t));if(!h(e,n))throw new Error("bad point: is not on curve");return{x:e,y:n}}throw new Error(`bad point: got length ${i}, expected compressed=${n} or uncompressed=${o}`)}{const e=r.fromBytes(c);if(!r.isValid(e))throw new Error("bad point: is not on curve, wrong x");const t=u(e);let n;try{n=r.sqrt(t)}catch(e){const t=e instanceof Error?": "+e.message:"";throw new Error("bad point: is not on curve, sqrt error"+t)}return f(),!(1&~s)!==r.isOdd(n)&&(n=r.neg(n)),{x:e,y:n}}},u=function(e,t,r){return function(n){const o=e.sqr(n),i=e.mul(o,n);return e.add(e.add(i,e.mul(n,t)),r)}}(r,e.a,e.b);function h(e,t){const n=r.sqr(t),o=u(e);return r.eql(n,o)}if(!h(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const d=r.mul(r.pow(e.a,En),xn),l=r.mul(r.sqr(e.b),BigInt(27));if(r.is0(r.add(d,l)))throw new Error("bad curve params: a or b");function p(e,t,n=!1){if(!r.isValid(t)||n&&r.is0(t))throw new Error(`bad point coordinate ${e}`);return t}function y(e){if(!(e instanceof m))throw new Error("ProjectivePoint expected")}const w=cr(((e,t)=>{const{px:n,py:o,pz:i}=e;if(r.eql(i,r.ONE))return{x:n,y:o};const s=e.is0();null==t&&(t=s?r.ONE:r.inv(i));const f=r.mul(n,t),c=r.mul(o,t),a=r.mul(i,t);if(s)return{x:r.ZERO,y:r.ZERO};if(!r.eql(a,r.ONE))throw new Error("invZ was invalid");return{x:f,y:c}})),g=cr((e=>{if(e.is0()){if(t.allowInfinityPoint&&!r.is0(e.py))return;throw new Error("bad point: ZERO")}const{x:n,y:o}=e.toAffine();if(!r.isValid(n)||!r.isValid(o))throw new Error("bad point: x or y not field elements");if(!h(n,o))throw new Error("bad point: equation left != right");if(!e.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0}));function b(e,t,n,o,i){return n=new m(r.mul(n.px,e),n.py,n.pz),t=Pr(o,t),n=Pr(i,n),t.add(n)}class m{constructor(e,t,r){this.px=p("x",e),this.py=p("y",t,!0),this.pz=p("z",r),Object.freeze(this)}static fromAffine(e){const{x:t,y:n}=e||{};if(!e||!r.isValid(t)||!r.isValid(n))throw new Error("invalid affine point");if(e instanceof m)throw new Error("projective point not allowed");return r.is0(t)&&r.is0(n)?m.ZERO:new m(t,n,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){return Or(m,"pz",e)}static fromBytes(e){return Ge(e),m.fromHex(e)}static fromHex(e){const t=m.fromAffine(a(nr("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){const r=An(n,t.allowedPrivateKeyLengths,t.wrapPrivateKey);return m.BASE.multiply(r(e))}static msm(e,t){return jr(m,n,e,t)}precompute(e=8,t=!0){return E.setWindowSize(this,e),t||this.multiply(En),this}_setWindowSize(e){this.precompute(e)}assertValidity(){g(this)}hasEvenY(){const{y:e}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(e)}equals(e){y(e);const{px:t,py:n,pz:o}=this,{px:i,py:s,pz:f}=e,c=r.eql(r.mul(t,f),r.mul(i,o)),a=r.eql(r.mul(n,f),r.mul(s,o));return c&&a}negate(){return new m(this.px,r.neg(this.py),this.pz)}double(){const{a:t,b:n}=e,o=r.mul(n,En),{px:i,py:s,pz:f}=this;let c=r.ZERO,a=r.ZERO,u=r.ZERO,h=r.mul(i,i),d=r.mul(s,s),l=r.mul(f,f),p=r.mul(i,s);return p=r.add(p,p),u=r.mul(i,f),u=r.add(u,u),c=r.mul(t,u),a=r.mul(o,l),a=r.add(c,a),c=r.sub(d,a),a=r.add(d,a),a=r.mul(c,a),c=r.mul(p,c),u=r.mul(o,u),l=r.mul(t,l),p=r.sub(h,l),p=r.mul(t,p),p=r.add(p,u),u=r.add(h,h),h=r.add(u,h),h=r.add(h,l),h=r.mul(h,p),a=r.add(a,h),l=r.mul(s,f),l=r.add(l,l),h=r.mul(l,p),c=r.sub(c,h),u=r.mul(l,d),u=r.add(u,u),u=r.add(u,u),new m(c,a,u)}add(t){y(t);const{px:n,py:o,pz:i}=this,{px:s,py:f,pz:c}=t;let a=r.ZERO,u=r.ZERO,h=r.ZERO;const d=e.a,l=r.mul(e.b,En);let p=r.mul(n,s),w=r.mul(o,f),g=r.mul(i,c),b=r.add(n,o),v=r.add(s,f);b=r.mul(b,v),v=r.add(p,w),b=r.sub(b,v),v=r.add(n,i);let E=r.add(s,c);return v=r.mul(v,E),E=r.add(p,g),v=r.sub(v,E),E=r.add(o,i),a=r.add(f,c),E=r.mul(E,a),a=r.add(w,g),E=r.sub(E,a),h=r.mul(d,v),a=r.mul(l,g),h=r.add(a,h),a=r.sub(w,h),h=r.add(w,h),u=r.mul(a,h),w=r.add(p,p),w=r.add(w,p),g=r.mul(d,g),v=r.mul(l,v),w=r.add(w,g),g=r.sub(p,g),g=r.mul(d,g),v=r.add(v,g),p=r.mul(w,v),u=r.add(u,p),p=r.mul(E,v),a=r.mul(b,a),a=r.sub(a,p),p=r.mul(b,w),h=r.mul(E,h),h=r.add(h,p),new m(a,u,h)}subtract(e){return this.add(e.negate())}is0(){return this.equals(m.ZERO)}multiply(e){const{endo:r}=t;if(!n.isValidNot0(e))throw new Error("invalid scalar: out of range");let o,i;const s=e=>E.wNAFCached(this,e,m.normalizeZ);if(r){const{k1neg:t,k1:n,k2neg:f,k2:c}=r.splitScalar(e),{p:a,f:u}=s(n),{p:h,f:d}=s(c);i=u.add(d),o=b(r.beta,a,h,t,f)}else{const{p:t,f:r}=s(e);o=t,i=r}return m.normalizeZ([o,i])[0]}multiplyUnsafe(e){const{endo:r}=t,o=this;if(!n.isValid(e))throw new Error("invalid scalar: out of range");if(e===bn||o.is0())return m.ZERO;if(e===mn)return o;if(E.hasPrecomputes(this))return this.multiply(e);if(r){const{k1neg:t,k1:n,k2neg:i,k2:s}=r.splitScalar(e),{p1:f,p2:c}=function(e,t,r,n){let o=t,i=e.ZERO,s=e.ZERO;for(;r>kr||n>kr;)r&Ur&&(i=i.add(o)),n&Ur&&(s=s.add(o)),o=o.double(),r>>=Ur,n>>=Ur;return{p1:i,p2:s}}(m,o,n,s);return b(r.beta,f,c,t,i)}return E.wNAFCachedUnsafe(o,e)}multiplyAndAddUnsafe(e,t,r){const n=this.multiplyUnsafe(t).add(e.multiplyUnsafe(r));return n.is0()?void 0:n}toAffine(e){return w(this,e)}isTorsionFree(){const{isTorsionFree:e}=t;return o===mn||(e?e(m,this):E.wNAFCachedUnsafe(this,i).is0())}clearCofactor(){const{clearCofactor:e}=t;return o===mn?this:e?e(m,this):this.multiplyUnsafe(o)}toBytes(e=!0){return Zt("isCompressed",e),this.assertValidity(),c(m,this,e)}toRawBytes(e=!0){return this.toBytes(e)}toHex(e=!0){return it(this.toBytes(e))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}m.BASE=new m(e.Gx,e.Gy,r.ONE),m.ZERO=new m(r.ZERO,r.ONE,r.ZERO),m.Fp=r,m.Fn=n;const v=n.BITS,E=$r(m,t.endo?Math.ceil(v/2):v);return m}(t,r),n,r))}function kn(e,t){const r=t=>In({...e,hash:t});return{...r(t),create:r}}const Un={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},Pn=(BigInt(0),BigInt(1)),On=BigInt(2),Rn=(e,t)=>(e+t/On)/t;const Tn=Br(Un.p,void 0,void 0,{sqrt:function(e){const t=Un.p,r=BigInt(3),n=BigInt(6),o=BigInt(11),i=BigInt(22),s=BigInt(23),f=BigInt(44),c=BigInt(88),a=e*e*e%t,u=a*a*e%t,h=gr(u,r,t)*u%t,d=gr(h,r,t)*u%t,l=gr(d,On,t)*a%t,p=gr(l,o,t)*l%t,y=gr(p,i,t)*p%t,w=gr(y,f,t)*y%t,g=gr(w,c,t)*w%t,b=gr(g,f,t)*y%t,m=gr(b,r,t)*u%t,v=gr(m,s,t)*p%t,E=gr(v,n,t)*a%t,x=gr(E,On,t);if(!Tn.eql(Tn.sqr(x),e))throw new Error("Cannot find square root");return x}}),Nn=kn({...Un,Fp:Tn,lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=Un.n,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-Pn*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=r,s=BigInt("0x100000000000000000000000000000000"),f=Rn(i*e,t),c=Rn(-n*e,t);let a=wr(e-f*r-c*o,t),u=wr(-f*n-c*i,t);const h=a>s,d=u>s;if(h&&(a=t-a),d&&(u=t-u),a>s||u>s)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:h,k1:a,k2neg:d,k2:u}}}},Jt),Cn={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},Kn={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},Ln={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},Dn=Br(Cn.p),$n=Br(Kn.p),jn=Br(Ln.p),_n=kn({...Cn,Fp:Dn,lowS:!1},Jt),Vn=(kn({...Kn,Fp:$n,lowS:!1},Wt),kn({...Ln,Fp:jn,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},Mt),_n),Fn=Jt,Hn=Uint8Array.from([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),zn=(()=>Uint8Array.from(new Array(16).fill(0).map(((e,t)=>t))))(),Jn=(()=>zn.map((e=>(9*e+5)%16)))(),Mn=(()=>{const e=[[zn],[Jn]];for(let t=0;t<4;t++)for(let r of e)r.push(r[t].map((e=>Hn[e])));return e})(),Wn=(()=>Mn[0])(),qn=(()=>Mn[1])(),Gn=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map((e=>Uint8Array.from(e))),Zn=Wn.map(((e,t)=>e.map((e=>Gn[t][e])))),Xn=qn.map(((e,t)=>e.map((e=>Gn[t][e])))),Yn=Uint32Array.from([0,1518500249,1859775393,2400959708,2840853838]),Qn=Uint32Array.from([1352829926,1548603684,1836072691,2053994217,0]);function eo(e,t,r,n){return 0===e?t^r^n:1===e?t&r|~t&n:2===e?(t|~r)^n:3===e?t&n|r&~n:t^(r|~n)}const to=new Uint32Array(16);class ro extends pt{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:e,h1:t,h2:r,h3:n,h4:o}=this;return[e,t,r,n,o]}set(e,t,r,n,o){this.h0=0|e,this.h1=0|t,this.h2=0|r,this.h3=0|n,this.h4=0|o}process(e,t){for(let r=0;r<16;r++,t+=4)to[r]=e.getUint32(t,!0);let r=0|this.h0,n=r,o=0|this.h1,i=o,s=0|this.h2,f=s,c=0|this.h3,a=c,u=0|this.h4,h=u;for(let e=0;e<5;e++){const t=4-e,d=Yn[e],l=Qn[e],p=Wn[e],y=qn[e],w=Zn[e],g=Xn[e];for(let t=0;t<16;t++){const n=tt(r+eo(e,o,s,c)+to[p[t]]+d,w[t])+u|0;r=u,u=c,c=0|tt(s,10),s=o,o=n}for(let e=0;e<16;e++){const r=tt(n+eo(t,i,f,a)+to[y[e]]+l,g[e])+h|0;n=h,h=a,a=0|tt(f,10),f=i,i=r}}this.set(this.h1+s+a|0,this.h2+c+h|0,this.h3+u+n|0,this.h4+r+i|0,this.h0+o+f|0)}roundClean(){Ye(to)}destroy(){this.destroyed=!0,Ye(this.buffer),this.set(0,0,0,0,0)}}const no=ht((()=>new ro)),oo=BigInt(0),io=BigInt(1),so=BigInt(2),fo=BigInt(7),co=BigInt(256),ao=BigInt(113),uo=[],ho=[],lo=[];for(let e=0,t=io,r=1,n=0;e<24;e++){[r,n]=[n,(2*r+3*n)%5],uo.push(2*(5*n+r)),ho.push((e+1)*(e+2)/2%64);let o=oo;for(let e=0;e<7;e++)t=(t<<io^(t>>fo)*ao)%co,t&so&&(o^=io<<(io<<BigInt(e))-io);lo.push(o)}const po=Et(lo,!0),yo=po[0],wo=po[1],go=(e,t,r)=>r>32?((e,t,r)=>t<<r-32|e>>>64-r)(e,t,r):((e,t,r)=>e<<r|t>>>32-r)(e,t,r),bo=(e,t,r)=>r>32?((e,t,r)=>e<<r-32|t>>>64-r)(e,t,r):((e,t,r)=>t<<r|e>>>32-r)(e,t,r);class mo extends ut{constructor(e,t,r,n=!1,o=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=t,this.outputLen=r,this.enableXOF=n,this.rounds=o,qe(r),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");var i;this.state=new Uint8Array(200),this.state32=(i=this.state,new Uint32Array(i.buffer,i.byteOffset,Math.floor(i.byteLength/4)))}clone(){return this._cloneInto()}keccak(){rt(this.state32),function(e,t=24){const r=new Uint32Array(10);for(let n=24-t;n<24;n++){for(let t=0;t<10;t++)r[t]=e[t]^e[t+10]^e[t+20]^e[t+30]^e[t+40];for(let t=0;t<10;t+=2){const n=(t+8)%10,o=(t+2)%10,i=r[o],s=r[o+1],f=go(i,s,1)^r[n],c=bo(i,s,1)^r[n+1];for(let r=0;r<50;r+=10)e[t+r]^=f,e[t+r+1]^=c}let t=e[2],o=e[3];for(let r=0;r<24;r++){const n=ho[r],i=go(t,o,n),s=bo(t,o,n),f=uo[r];t=e[f],o=e[f+1],e[f]=i,e[f+1]=s}for(let t=0;t<50;t+=10){for(let n=0;n<10;n++)r[n]=e[t+n];for(let n=0;n<10;n++)e[t+n]^=~r[(n+2)%10]&r[(n+4)%10]}e[0]^=yo[n],e[1]^=wo[n]}Ye(r)}(this.state32,this.rounds),rt(this.state32),this.posOut=0,this.pos=0}update(e){Ze(this),Ge(e=ct(e));const{blockLen:t,state:r}=this,n=e.length;for(let o=0;o<n;){const i=Math.min(t-this.pos,n-o);for(let t=0;t<i;t++)r[this.pos++]^=e[o++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:r,blockLen:n}=this;e[r]^=t,128&t&&r===n-1&&this.keccak(),e[n-1]^=128,this.keccak()}writeInto(e){Ze(this,!1),Ge(e),this.finish();const t=this.state,{blockLen:r}=this;for(let n=0,o=e.length;n<o;){this.posOut>=r&&this.keccak();const i=Math.min(r-this.posOut,o-n);e.set(t.subarray(this.posOut,this.posOut+i),n),this.posOut+=i,n+=i}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return qe(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Xe(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Ye(this.state)}_cloneInto(e){const{blockLen:t,suffix:r,outputLen:n,rounds:o,enableXOF:i}=this;return e||(e=new mo(t,r,n,i,o)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=o,e.suffix=r,e.outputLen=n,e.enableXOF=i,e.destroyed=this.destroyed,e}}const vo=(()=>{return e=1,t=136,r=32,ht((()=>new mo(t,e,r)));var e,t,r})();var Eo=r(341);const xo="(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))",Ao="[a-zA-Z0-9_.:%-]",Bo=new RegExp(`^did:([a-z0-9]+):((?:${xo}*:)*(${xo}+))((;${Ao}+=${Ao}*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$`);function So(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function Io(e,...t){if(!So(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function ko(e,t){return!!Array.isArray(t)&&(0===t.length||(e?t.every((e=>"string"==typeof e)):t.every((e=>Number.isSafeInteger(e)))))}function Uo(e){if("function"!=typeof e)throw new Error("function expected");return!0}function Po(e,t){if("string"!=typeof t)throw new Error(`${e}: string expected`);return!0}function Oo(e){if(!Number.isSafeInteger(e))throw new Error(`invalid integer: ${e}`)}function Ro(e){if(!Array.isArray(e))throw new Error("array expected")}function To(e,t){if(!ko(!0,t))throw new Error(`${e}: array of strings expected`)}function No(e,t){if(!ko(!1,t))throw new Error(`${e}: array of numbers expected`)}function Co(...e){const t=e=>e,r=(e,t)=>r=>e(t(r));return{encode:e.map((e=>e.encode)).reduceRight(r,t),decode:e.map((e=>e.decode)).reduce(r,t)}}function Ko(e){const t="string"==typeof e?e.split(""):e,r=t.length;To("alphabet",t);const n=new Map(t.map(((e,t)=>[e,t])));return{encode:n=>(Ro(n),n.map((n=>{if(!Number.isSafeInteger(n)||n<0||n>=r)throw new Error(`alphabet.encode: digit index outside alphabet "${n}". Allowed: ${e}`);return t[n]}))),decode:t=>(Ro(t),t.map((t=>{Po("alphabet.decode",t);const r=n.get(t);if(void 0===r)throw new Error(`Unknown letter: "${t}". Allowed: ${e}`);return r})))}}function Lo(e=""){return Po("join",e),{encode:t=>(To("join.decode",t),t.join(e)),decode:t=>(Po("join.decode",t),t.split(e))}}function Do(e,t="="){return Oo(e),Po("padding",t),{encode(r){for(To("padding.encode",r);r.length*e%8;)r.push(t);return r},decode(r){To("padding.decode",r);let n=r.length;if(n*e%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;n>0&&r[n-1]===t;n--)if((n-1)*e%8==0)throw new Error("padding: invalid, string has too much padding");return r.slice(0,n)}}}function $o(e){return Uo(e),{encode:e=>e,decode:t=>e(t)}}function jo(e,t,r){if(t<2)throw new Error(`convertRadix: invalid from=${t}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: invalid to=${r}, base cannot be less than 2`);if(Ro(e),!e.length)return[];let n=0;const o=[],i=Array.from(e,(e=>{if(Oo(e),e<0||e>=t)throw new Error(`invalid integer: ${e}`);return e})),s=i.length;for(;;){let e=0,f=!0;for(let o=n;o<s;o++){const s=i[o],c=t*e,a=c+s;if(!Number.isSafeInteger(a)||c/t!==e||a-s!==c)throw new Error("convertRadix: carry overflow");const u=a/r;e=a%r;const h=Math.floor(u);if(i[o]=h,!Number.isSafeInteger(h)||h*r+e!==a)throw new Error("convertRadix: carry overflow");f&&(h?f=!1:n=o)}if(o.push(e),f)break}for(let t=0;t<e.length-1&&0===e[t];t++)o.push(0);return o.reverse()}const _o=(e,t)=>0===t?e:_o(t,e%t),Vo=(e,t)=>e+(t-_o(e,t)),Fo=(()=>{let e=[];for(let t=0;t<40;t++)e.push(2**t);return e})();function Ho(e,t,r,n){if(Ro(e),t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(Vo(t,r)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${r} carryBits=${Vo(t,r)}`);let o=0,i=0;const s=Fo[t],f=Fo[r]-1,c=[];for(const n of e){if(Oo(n),n>=s)throw new Error(`convertRadix2: invalid data word=${n} from=${t}`);if(o=o<<t|n,i+t>32)throw new Error(`convertRadix2: carry overflow pos=${i} from=${t}`);for(i+=t;i>=r;i-=r)c.push((o>>i-r&f)>>>0);const e=Fo[i];if(void 0===e)throw new Error("invalid carry");o&=e-1}if(o=o<<r-i&f,!n&&i>=t)throw new Error("Excess padding");if(!n&&o>0)throw new Error(`Non-zero padding: ${o}`);return n&&i>0&&c.push(o>>>0),c}function zo(e,t=!1){if(Oo(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(Vo(8,e)>32||Vo(e,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!So(r))throw new Error("radix2.encode input should be Uint8Array");return Ho(Array.from(r),8,e,!t)},decode:r=>(No("radix2.decode",r),Uint8Array.from(Ho(r,e,8,t)))}}function Jo(e){return Uo(e),function(...t){try{return e.apply(null,t)}catch(e){}}}Co(zo(4),Ko("0123456789ABCDEF"),Lo("")),Co(zo(5),Ko("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Do(5),Lo(""));const Mo=(Co(zo(5),Ko("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Lo("")),Co(zo(5),Ko("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Do(5),Lo("")),Co(zo(5),Ko("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Lo("")),Co(zo(5),Ko("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),Lo(""),$o((e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),(()=>"function"==typeof Uint8Array.from([]).toBase64&&"function"==typeof Uint8Array.fromBase64)()),Wo=(e,t)=>{Po("base64",e);const r=t?/^[A-Za-z0-9=_-]+$/:/^[A-Za-z0-9=+/]+$/,n=t?"base64url":"base64";if(e.length>0&&!r.test(e))throw new Error("invalid base64");return Uint8Array.fromBase64(e,{alphabet:n,lastChunkHandling:"strict"})},qo=(Mo||Co(zo(6),Ko("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Do(6),Lo("")),Co(zo(6),Ko("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Lo("")),Mo||Co(zo(6),Ko("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Do(6),Lo("")),Co(zo(6),Ko("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Lo("")),e=>{return Co((Oo(t=58),{encode:e=>{if(!So(e))throw new Error("radix.encode input should be Uint8Array");return jo(Array.from(e),256,t)},decode:e=>(No("radix.decode",e),Uint8Array.from(jo(e,t,256)))}),Ko(e),Lo(""));var t}),Go=(qo("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),qo("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),qo("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz"),Co(Ko("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Lo(""))),Zo=[996825010,642813549,513874426,1027748829,705979059];function Xo(e){const t=e>>25;let r=(33554431&e)<<5;for(let e=0;e<Zo.length;e++)1==(t>>e&1)&&(r^=Zo[e]);return r}function Yo(e,t,r=1){const n=e.length;let o=1;for(let t=0;t<n;t++){const r=e.charCodeAt(t);if(r<33||r>126)throw new Error(`Invalid prefix (${e})`);o=Xo(o)^r>>5}o=Xo(o);for(let t=0;t<n;t++)o=Xo(o)^31&e.charCodeAt(t);for(let e of t)o=Xo(o)^e;for(let e=0;e<6;e++)o=Xo(o);return o^=r,Go.encode(Ho([o%Fo[30]],30,5,!1))}function Qo(e){const t="bech32"===e?1:734539939,r=zo(5),n=r.decode,o=r.encode,i=Jo(n);function s(e,r,n=90){Po("bech32.encode prefix",e),So(r)&&(r=Array.from(r)),No("bech32.encode",r);const o=e.length;if(0===o)throw new TypeError(`Invalid prefix length ${o}`);const i=o+7+r.length;if(!1!==n&&i>n)throw new TypeError(`Length ${i} exceeds limit ${n}`);const s=e.toLowerCase(),f=Yo(s,r,t);return`${s}1${Go.encode(r)}${f}`}function f(e,r=90){Po("bech32.decode input",e);const n=e.length;if(n<8||!1!==r&&n>r)throw new TypeError(`invalid string length: ${n} (${e}). Expected (8..${r})`);const o=e.toLowerCase();if(e!==o&&e!==e.toUpperCase())throw new Error("String must be lowercase or uppercase");const i=o.lastIndexOf("1");if(0===i||-1===i)throw new Error('Letter "1" must be present between prefix and data only');const s=o.slice(0,i),f=o.slice(i+1);if(f.length<6)throw new Error("Data must be at least 6 characters long");const c=Go.decode(f).slice(0,-6),a=Yo(s,c,t);if(!f.endsWith(a))throw new Error(`Invalid checksum in ${e}: expected "${a}"`);return{prefix:s,words:c}}return{encode:s,decode:f,encodeFromBytes:function(e,t){return s(e,o(t))},decodeToBytes:function(e){const{prefix:t,words:r}=f(e,!1);return{prefix:t,words:r,bytes:n(r)}},decodeUnsafe:Jo(f),fromWords:n,fromWordsUnsafe:i,toWords:o}}const ei=Qo("bech32");Qo("bech32m");function ti(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function ri(e){if("boolean"!=typeof e)throw new Error(`boolean expected, not ${e}`)}function ni(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function oi(e,...t){if(!ti(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function ii(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function si(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function fi(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}(()=>"function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex)()||Co(zo(4),Ko("0123456789abcdef"),Lo(""),$o((e=>{if("string"!=typeof e||e.length%2!=0)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})));const ci=(()=>68===new Uint8Array(new Uint32Array([287454020]).buffer)[0])();function ai(e){if("string"==typeof e)e=function(e){if("string"!=typeof e)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(e))}(e);else{if(!ti(e))throw new Error("Uint8Array expected, got "+typeof e);e=li(e)}return e}const ui=(e,t)=>{function r(r,...n){if(oi(r),!ci)throw new Error("Non little-endian hardware is not yet supported");if(void 0!==e.nonceLength){const t=n[0];if(!t)throw new Error("nonce / iv required");e.varSizeNonce?oi(t):oi(t,e.nonceLength)}const o=e.tagLength;o&&void 0!==n[1]&&oi(n[1]);const i=t(r,...n),s=(e,t)=>{if(void 0!==t){if(2!==e)throw new Error("cipher output not supported");oi(t)}};let f=!1;return{encrypt(e,t){if(f)throw new Error("cannot encrypt() twice with same key + nonce");return f=!0,oi(e),s(i.encrypt.length,t),i.encrypt(e,t)},decrypt(e,t){if(oi(e),o&&e.length<o)throw new Error("invalid ciphertext length: smaller than tagLength="+o);return s(i.decrypt.length,t),i.decrypt(e,t)}}}return Object.assign(r,e),r};function hi(e,t,r=!0){if(void 0===t)return new Uint8Array(e);if(t.length!==e)throw new Error("invalid output length, expected "+e+", got: "+t.length);if(r&&t.byteOffset%4!=0)throw new Error("invalid output, must be aligned");return t}function di(e,t,r,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,n);const o=BigInt(32),i=BigInt(4294967295),s=Number(r>>o&i),f=Number(r&i),c=n?4:0,a=n?0:4;e.setUint32(t+c,s,n),e.setUint32(t+a,f,n)}function li(e){return Uint8Array.from(e)}const pi=e=>Uint8Array.from(e.split("").map((e=>e.charCodeAt(0)))),yi=pi("expand 16-byte k"),wi=pi("expand 32-byte k"),gi=si(yi),bi=si(wi);function mi(e,t){return e<<t|e>>>32-t}function vi(e){return e.byteOffset%4==0}const Ei=2**32-1,xi=new Uint32Array;function Ai(e,t){const{allowShortKeys:r,extendNonceFn:n,counterLength:o,counterRight:i,rounds:s}=function(e,t){if(null==t||"object"!=typeof t)throw new Error("options must be defined");return Object.assign({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t)}(0,t);if("function"!=typeof e)throw new Error("core must be a function");return ni(o),ni(s),ri(i),ri(r),(t,f,c,a,u=0)=>{oi(t),oi(f),oi(c);const h=c.length;if(void 0===a&&(a=new Uint8Array(h)),oi(a),ni(u),u<0||u>=Ei)throw new Error("arx: counter overflow");if(a.length<h)throw new Error(`arx: output (${a.length}) is shorter than data (${h})`);const d=[];let l,p,y=t.length;if(32===y)d.push(l=li(t)),p=bi;else{if(16!==y||!r)throw new Error(`arx: invalid 32-byte key, got length=${y}`);l=new Uint8Array(32),l.set(t),l.set(t,16),p=gi,d.push(l)}vi(f)||d.push(f=li(f));const w=si(l);if(n){if(24!==f.length)throw new Error("arx: extended nonce must be 24 bytes");n(p,w,si(f.subarray(0,16)),w),f=f.subarray(16)}const g=16-o;if(g!==f.length)throw new Error(`arx: nonce must be ${g} or 16 bytes`);if(12!==g){const e=new Uint8Array(12);e.set(f,i?0:12-f.length),f=e,d.push(f)}const b=si(f);return function(e,t,r,n,o,i,s,f){const c=o.length,a=new Uint8Array(64),u=si(a),h=vi(o)&&vi(i),d=h?si(o):xi,l=h?si(i):xi;for(let p=0;p<c;s++){if(e(t,r,n,u,s,f),s>=Ei)throw new Error("arx: counter overflow");const y=Math.min(64,c-p);if(h&&64===y){const e=p/4;if(p%4!=0)throw new Error("arx: invalid block position");for(let t,r=0;r<16;r++)t=e+r,l[t]=d[t]^u[r];p+=64}else{for(let e,t=0;t<y;t++)e=p+t,i[e]=o[e]^a[t];p+=y}}}(e,p,w,b,c,a,u,s),fi(...d),a}}const Bi=(e,t)=>255&e[t++]|(255&e[t++])<<8;class Si{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,oi(e=ai(e),32);const t=Bi(e,0),r=Bi(e,2),n=Bi(e,4),o=Bi(e,6),i=Bi(e,8),s=Bi(e,10),f=Bi(e,12),c=Bi(e,14);this.r[0]=8191&t,this.r[1]=8191&(t>>>13|r<<3),this.r[2]=7939&(r>>>10|n<<6),this.r[3]=8191&(n>>>7|o<<9),this.r[4]=255&(o>>>4|i<<12),this.r[5]=i>>>1&8190,this.r[6]=8191&(i>>>14|s<<2),this.r[7]=8065&(s>>>11|f<<5),this.r[8]=8191&(f>>>8|c<<8),this.r[9]=c>>>5&127;for(let t=0;t<8;t++)this.pad[t]=Bi(e,16+2*t)}process(e,t,r=!1){const n=r?0:2048,{h:o,r:i}=this,s=i[0],f=i[1],c=i[2],a=i[3],u=i[4],h=i[5],d=i[6],l=i[7],p=i[8],y=i[9],w=Bi(e,t+0),g=Bi(e,t+2),b=Bi(e,t+4),m=Bi(e,t+6),v=Bi(e,t+8),E=Bi(e,t+10),x=Bi(e,t+12),A=Bi(e,t+14);let B=o[0]+(8191&w),S=o[1]+(8191&(w>>>13|g<<3)),I=o[2]+(8191&(g>>>10|b<<6)),k=o[3]+(8191&(b>>>7|m<<9)),U=o[4]+(8191&(m>>>4|v<<12)),P=o[5]+(v>>>1&8191),O=o[6]+(8191&(v>>>14|E<<2)),R=o[7]+(8191&(E>>>11|x<<5)),T=o[8]+(8191&(x>>>8|A<<8)),N=o[9]+(A>>>5|n),C=0,K=C+B*s+S*(5*y)+I*(5*p)+k*(5*l)+U*(5*d);C=K>>>13,K&=8191,K+=P*(5*h)+O*(5*u)+R*(5*a)+T*(5*c)+N*(5*f),C+=K>>>13,K&=8191;let L=C+B*f+S*s+I*(5*y)+k*(5*p)+U*(5*l);C=L>>>13,L&=8191,L+=P*(5*d)+O*(5*h)+R*(5*u)+T*(5*a)+N*(5*c),C+=L>>>13,L&=8191;let D=C+B*c+S*f+I*s+k*(5*y)+U*(5*p);C=D>>>13,D&=8191,D+=P*(5*l)+O*(5*d)+R*(5*h)+T*(5*u)+N*(5*a),C+=D>>>13,D&=8191;let $=C+B*a+S*c+I*f+k*s+U*(5*y);C=$>>>13,$&=8191,$+=P*(5*p)+O*(5*l)+R*(5*d)+T*(5*h)+N*(5*u),C+=$>>>13,$&=8191;let j=C+B*u+S*a+I*c+k*f+U*s;C=j>>>13,j&=8191,j+=P*(5*y)+O*(5*p)+R*(5*l)+T*(5*d)+N*(5*h),C+=j>>>13,j&=8191;let _=C+B*h+S*u+I*a+k*c+U*f;C=_>>>13,_&=8191,_+=P*s+O*(5*y)+R*(5*p)+T*(5*l)+N*(5*d),C+=_>>>13,_&=8191;let V=C+B*d+S*h+I*u+k*a+U*c;C=V>>>13,V&=8191,V+=P*f+O*s+R*(5*y)+T*(5*p)+N*(5*l),C+=V>>>13,V&=8191;let F=C+B*l+S*d+I*h+k*u+U*a;C=F>>>13,F&=8191,F+=P*c+O*f+R*s+T*(5*y)+N*(5*p),C+=F>>>13,F&=8191;let H=C+B*p+S*l+I*d+k*h+U*u;C=H>>>13,H&=8191,H+=P*a+O*c+R*f+T*s+N*(5*y),C+=H>>>13,H&=8191;let z=C+B*y+S*p+I*l+k*d+U*h;C=z>>>13,z&=8191,z+=P*u+O*a+R*c+T*f+N*s,C+=z>>>13,z&=8191,C=(C<<2)+C|0,C=C+K|0,K=8191&C,C>>>=13,L+=C,o[0]=K,o[1]=L,o[2]=D,o[3]=$,o[4]=j,o[5]=_,o[6]=V,o[7]=F,o[8]=H,o[9]=z}finalize(){const{h:e,pad:t}=this,r=new Uint16Array(10);let n=e[1]>>>13;e[1]&=8191;for(let t=2;t<10;t++)e[t]+=n,n=e[t]>>>13,e[t]&=8191;e[0]+=5*n,n=e[0]>>>13,e[0]&=8191,e[1]+=n,n=e[1]>>>13,e[1]&=8191,e[2]+=n,r[0]=e[0]+5,n=r[0]>>>13,r[0]&=8191;for(let t=1;t<10;t++)r[t]=e[t]+n,n=r[t]>>>13,r[t]&=8191;r[9]-=8192;let o=(1^n)-1;for(let e=0;e<10;e++)r[e]&=o;o=~o;for(let t=0;t<10;t++)e[t]=e[t]&o|r[t];e[0]=65535&(e[0]|e[1]<<13),e[1]=65535&(e[1]>>>3|e[2]<<10),e[2]=65535&(e[2]>>>6|e[3]<<7),e[3]=65535&(e[3]>>>9|e[4]<<4),e[4]=65535&(e[4]>>>12|e[5]<<1|e[6]<<14),e[5]=65535&(e[6]>>>2|e[7]<<11),e[6]=65535&(e[7]>>>5|e[8]<<8),e[7]=65535&(e[8]>>>8|e[9]<<5);let i=e[0]+t[0];e[0]=65535&i;for(let r=1;r<8;r++)i=(e[r]+t[r]|0)+(i>>>16)|0,e[r]=65535&i;fi(r)}update(e){ii(this),oi(e=ai(e));const{buffer:t,blockLen:r}=this,n=e.length;for(let o=0;o<n;){const i=Math.min(r-this.pos,n-o);if(i!==r)t.set(e.subarray(o,o+i),this.pos),this.pos+=i,o+=i,this.pos===r&&(this.process(t,0,!1),this.pos=0);else for(;r<=n-o;o+=r)this.process(e,o)}return this}destroy(){fi(this.h,this.r,this.buffer,this.pad)}digestInto(e){ii(this),function(e,t){oi(e);const r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}(e,this),this.finished=!0;const{buffer:t,h:r}=this;let{pos:n}=this;if(n){for(t[n++]=1;n<16;n++)t[n]=0;this.process(t,0,!0)}this.finalize();let o=0;for(let t=0;t<8;t++)e[o++]=r[t]>>>0,e[o++]=r[t]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}}const Ii=function(e){const t=(t,r)=>e(r).update(ai(t)).digest(),r=e(new Uint8Array(32));return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t}((e=>new Si(e)));function ki(e,t,r,n,o,i=20){let s=e[0],f=e[1],c=e[2],a=e[3],u=t[0],h=t[1],d=t[2],l=t[3],p=t[4],y=t[5],w=t[6],g=t[7],b=o,m=r[0],v=r[1],E=r[2],x=s,A=f,B=c,S=a,I=u,k=h,U=d,P=l,O=p,R=y,T=w,N=g,C=b,K=m,L=v,D=E;for(let e=0;e<i;e+=2)x=x+I|0,C=mi(C^x,16),O=O+C|0,I=mi(I^O,12),x=x+I|0,C=mi(C^x,8),O=O+C|0,I=mi(I^O,7),A=A+k|0,K=mi(K^A,16),R=R+K|0,k=mi(k^R,12),A=A+k|0,K=mi(K^A,8),R=R+K|0,k=mi(k^R,7),B=B+U|0,L=mi(L^B,16),T=T+L|0,U=mi(U^T,12),B=B+U|0,L=mi(L^B,8),T=T+L|0,U=mi(U^T,7),S=S+P|0,D=mi(D^S,16),N=N+D|0,P=mi(P^N,12),S=S+P|0,D=mi(D^S,8),N=N+D|0,P=mi(P^N,7),x=x+k|0,D=mi(D^x,16),T=T+D|0,k=mi(k^T,12),x=x+k|0,D=mi(D^x,8),T=T+D|0,k=mi(k^T,7),A=A+U|0,C=mi(C^A,16),N=N+C|0,U=mi(U^N,12),A=A+U|0,C=mi(C^A,8),N=N+C|0,U=mi(U^N,7),B=B+P|0,K=mi(K^B,16),O=O+K|0,P=mi(P^O,12),B=B+P|0,K=mi(K^B,8),O=O+K|0,P=mi(P^O,7),S=S+I|0,L=mi(L^S,16),R=R+L|0,I=mi(I^R,12),S=S+I|0,L=mi(L^S,8),R=R+L|0,I=mi(I^R,7);let $=0;n[$++]=s+x|0,n[$++]=f+A|0,n[$++]=c+B|0,n[$++]=a+S|0,n[$++]=u+I|0,n[$++]=h+k|0,n[$++]=d+U|0,n[$++]=l+P|0,n[$++]=p+O|0,n[$++]=y+R|0,n[$++]=w+T|0,n[$++]=g+N|0,n[$++]=b+C|0,n[$++]=m+K|0,n[$++]=v+L|0,n[$++]=E+D|0}const Ui=Ai(ki,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Pi=Ai(ki,{counterRight:!1,counterLength:8,extendNonceFn:function(e,t,r,n){let o=e[0],i=e[1],s=e[2],f=e[3],c=t[0],a=t[1],u=t[2],h=t[3],d=t[4],l=t[5],p=t[6],y=t[7],w=r[0],g=r[1],b=r[2],m=r[3];for(let e=0;e<20;e+=2)o=o+c|0,w=mi(w^o,16),d=d+w|0,c=mi(c^d,12),o=o+c|0,w=mi(w^o,8),d=d+w|0,c=mi(c^d,7),i=i+a|0,g=mi(g^i,16),l=l+g|0,a=mi(a^l,12),i=i+a|0,g=mi(g^i,8),l=l+g|0,a=mi(a^l,7),s=s+u|0,b=mi(b^s,16),p=p+b|0,u=mi(u^p,12),s=s+u|0,b=mi(b^s,8),p=p+b|0,u=mi(u^p,7),f=f+h|0,m=mi(m^f,16),y=y+m|0,h=mi(h^y,12),f=f+h|0,m=mi(m^f,8),y=y+m|0,h=mi(h^y,7),o=o+a|0,m=mi(m^o,16),p=p+m|0,a=mi(a^p,12),o=o+a|0,m=mi(m^o,8),p=p+m|0,a=mi(a^p,7),i=i+u|0,w=mi(w^i,16),y=y+w|0,u=mi(u^y,12),i=i+u|0,w=mi(w^i,8),y=y+w|0,u=mi(u^y,7),s=s+h|0,g=mi(g^s,16),d=d+g|0,h=mi(h^d,12),s=s+h|0,g=mi(g^s,8),d=d+g|0,h=mi(h^d,7),f=f+c|0,b=mi(b^f,16),l=l+b|0,c=mi(c^l,12),f=f+c|0,b=mi(b^f,8),l=l+b|0,c=mi(c^l,7);let v=0;n[v++]=o,n[v++]=i,n[v++]=s,n[v++]=f,n[v++]=w,n[v++]=g,n[v++]=b,n[v++]=m},allowShortKeys:!1}),Oi=new Uint8Array(16),Ri=(e,t)=>{e.update(t);const r=t.length%16;r&&e.update(Oi.subarray(r))},Ti=new Uint8Array(32);function Ni(e,t,r,n,o){const i=e(t,r,Ti),s=Ii.create(i);o&&Ri(s,o),Ri(s,n);const f=function(e,t,r){ri(r);const n=new Uint8Array(16),o=(i=n,new DataView(i.buffer,i.byteOffset,i.byteLength));var i;return di(o,0,BigInt(t),r),di(o,8,BigInt(e),r),n}(n.length,o?o.length:0,!0);s.update(f);const c=s.digest();return fi(i,f),c}const Ci=e=>(t,r,n)=>({encrypt(o,i){const s=o.length;(i=hi(s+16,i,!1)).set(o);const f=i.subarray(0,-16);e(t,r,f,f,1);const c=Ni(e,t,r,f,n);return i.set(c,s),fi(c),i},decrypt(o,i){i=hi(o.length-16,i,!1);const s=o.subarray(0,-16),f=o.subarray(-16),c=Ni(e,t,r,s,n);if(!function(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return 0===r}(f,c))throw new Error("invalid tag");return i.set(o.subarray(0,-16)),e(t,r,i,i,1),fi(c),i}}),Ki=(Ci(Ui),ui({blockSize:64,nonceLength:24,tagLength:16},Ci(Pi))),Li={toString:Je,fromString:ze,concat:m};function Di(e){return Li.toString(e,"base64url")}function $i(e){const t=e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"");return Li.fromString(t,"base64url")}function ji(e){return Li.fromString(e,"base58btc")}function _i(e){return Li.toString(e,"base58btc")}const Vi={ES256:["JsonWebKey2020","Multikey","EcdsaSecp256r1VerificationKey2019"],ES256K:["EcdsaSecp256k1VerificationKey2019","EcdsaSecp256k1RecoveryMethod2020","Secp256k1VerificationKey2018","Secp256k1SignatureVerificationKey2018","EcdsaPublicKeySecp256k1","JsonWebKey2020","Multikey"],"ES256K-R":["EcdsaSecp256k1VerificationKey2019","EcdsaSecp256k1RecoveryMethod2020","Secp256k1VerificationKey2018","Secp256k1SignatureVerificationKey2018","EcdsaPublicKeySecp256k1","ConditionalProof2022","JsonWebKey2020","Multikey"],Ed25519:["ED25519SignatureVerification","Ed25519VerificationKey2018","Ed25519VerificationKey2020","JsonWebKey2020","Multikey"],EdDSA:["ED25519SignatureVerification","Ed25519VerificationKey2018","Ed25519VerificationKey2020","JsonWebKey2020","Multikey"]},Fi={Secp256k1SignatureVerificationKey2018:"Secp256k1",Secp256k1VerificationKey2018:"Secp256k1",EcdsaSecp256k1VerificationKey2019:"Secp256k1",EcdsaPublicKeySecp256k1:"Secp256k1",EcdsaSecp256k1RecoveryMethod2020:"Secp256k1",EcdsaSecp256r1VerificationKey2019:"P-256",Ed25519VerificationKey2018:"Ed25519",Ed25519VerificationKey2020:"Ed25519",ED25519SignatureVerification:"Ed25519",X25519KeyAgreementKey2019:"X25519",X25519KeyAgreementKey2020:"X25519",ConditionalProof2022:void 0,JsonWebKey2020:void 0,Multikey:void 0},Hi={"ed25519-pub":237,"x25519-pub":236,"secp256k1-pub":231,"bls12_381-g1-pub":234,"bls12_381-g2-pub":235,"p256-pub":4608},zi={"bls12_381-g1-pub":"Bls12381G1","bls12_381-g2-pub":"Bls12381G2","ed25519-pub":"Ed25519","p256-pub":"P-256","secp256k1-pub":"Secp256k1","x25519-pub":"X25519"};function Ji(e){if(e.publicKeyBase58)return{keyBytes:ji(e.publicKeyBase58),keyType:Fi[e.type]};if(e.publicKeyBase64)return{keyBytes:$i(e.publicKeyBase64),keyType:Fi[e.type]};if(e.publicKeyHex)return{keyBytes:qi(e.publicKeyHex),keyType:Fi[e.type]};if(e.publicKeyJwk&&"secp256k1"===e.publicKeyJwk.crv&&e.publicKeyJwk.x&&e.publicKeyJwk.y)return{keyBytes:Nn.ProjectivePoint.fromAffine({x:Yi($i(e.publicKeyJwk.x)),y:Yi($i(e.publicKeyJwk.y))}).toRawBytes(!1),keyType:"Secp256k1"};if(e.publicKeyJwk&&"P-256"===e.publicKeyJwk.crv&&e.publicKeyJwk.x&&e.publicKeyJwk.y)return{keyBytes:Vn.ProjectivePoint.fromAffine({x:Yi($i(e.publicKeyJwk.x)),y:Yi($i(e.publicKeyJwk.y))}).toRawBytes(!1),keyType:"P-256"};if(e.publicKeyJwk&&"OKP"===e.publicKeyJwk.kty&&["Ed25519","X25519"].includes(e.publicKeyJwk.crv??"")&&e.publicKeyJwk.x)return{keyBytes:$i(e.publicKeyJwk.x),keyType:e.publicKeyJwk.crv};if(e.publicKeyMultibase){const{keyBytes:t,keyType:r}=Wi(e.publicKeyMultibase);return{keyBytes:t,keyType:r??Fi[e.type]}}return{keyBytes:new Uint8Array}}function Mi(e,t="base58btc",r){if(r){const n="string"==typeof r?Hi[r]:r,o=me(n),i=new Uint8Array(o+e.length);return be(n,i),i.set(e,o),Li.toString((0,dn.encode)(t,i),"utf-8")}return Li.toString((0,dn.encode)(t,e),"utf-8")}function Wi(e){const t=(0,dn.decode)(e);if([32,33,48,64,65,96].includes(t.length))return{keyBytes:t};try{const[e,r]=((e,t=0)=>[ge.decode(e,t),ge.decode.bytes])(t),n=Object.entries(Hi).filter((([,t])=>t===e))?.[0][0]??"";return{keyBytes:t.slice(r),keyType:zi[n]}}catch(e){return{keyBytes:t}}}function qi(e,t){let r=e.startsWith("0x")?e.substring(2):e;if(r.length%2!=0&&(r=`0${r}`),t){const e=Math.max(r.length,2*t);r=r.padStart(e,"00")}return Li.fromString(r.toLowerCase(),"base16")}function Gi(e){return Di(Li.fromString(e))}function Zi(e){return Li.toString($i(e))}function Xi(e){return Li.toString(e,"base16")}function Yi(e){return BigInt("0x"+Li.toString(e,"base16"))}function Qi(e){return Li.fromString(e,"utf-8")}function es({r:e,s:t,recoveryParam:r},n){const o=new Uint8Array(n?65:64);if(o.set(Li.fromString(e,"base16"),0),o.set(Li.fromString(t,"base16"),32),n){if(void 0===r)throw new Error("Signer did not return a recoveryParam");o[64]=r}return Di(o)}function ts(e){const t=$i(e);if(t.length<64||t.length>65)throw new TypeError(`Wrong size for signature. Expected 64 or 65 bytes, but got ${t.length}`);return{r:Xi(t.slice(0,32)),s:Xi(t.slice(32,64)),recoveryParam:65===t.length?t[64]:void 0}}function rs(e,t){return Li.concat([$i(e),t?$i(t):new Uint8Array(0)])}function ns(e,t=64){return e.length===t?e:"0".repeat(t-e.length)+e}function os(){const e=hn.utils.randomPrivateKey();return{secretKey:e,publicKey:hn.getPublicKey(e)}}function is(e){if(32!==e.length)throw new Error("x25519: seed must be 32 bytes");return{publicKey:hn.getPublicKey(e),secretKey:e}}function ss(){const e=os();return{publicKeyJWK:{kty:"OKP",crv:"X25519",x:Di(e.publicKey)},secretKey:e.secretKey}}function fs(e){return null!=e}function cs(e){const t="string"==typeof e?ze(e):e;return Fn(t)}const as=vo;function us(e){const t=ze(e.slice(2),"base16");return`0x${Je(as(t).slice(-20),"base16")}`}function hs(e,t=new Uint8Array(4)){const r=ze(e.toString(),"base10");return t.set(r,4-r.length),t}const ds=e=>m([hs(e.length),e]);function ls(e,t,r,n,o){if(256!==t)throw new Error(`Unsupported key length: ${t}`);const i=m([ds(ze(r)),ds(void 0===n?new Uint8Array(0):n),ds(void 0===o?new Uint8Array(0):o),hs(t)]);return cs(m([hs(1),e,i]))}function ps(e,t=!1){const r=e;if(32!==r.length)throw new Error(`bad_key: Invalid private key format. Expecting 32 bytes, but got ${r.length}`);return function(e){try{const n=Nn.sign(cs(e),r);return Promise.resolve(es({r:ns(n.r.toString(16)),s:ns(n.s.toString(16)),recoveryParam:n.recovery},t))}catch(e){return Promise.reject(e)}}}function ys(e){const t=ps(qi(e),!0);return function(e){try{return Promise.resolve(t(e)).then(ts)}catch(e){return Promise.reject(e)}}}function ws(e){return ps(qi(e))}function gs(e){const t=e;if(![32,64].includes(t.length))throw new Error(`bad_key: Invalid private key format. Expecting 32 or 64 bytes, but got ${t.length}`);return function(e){try{const r="string"==typeof e?Qi(e):e,n=un.sign(r,t.slice(0,32));return Promise.resolve(Di(n))}catch(e){return Promise.reject(e)}}}function bs(e){return gs($i(e))}function ms(e){if(32!==e.length)throw new Error(`bad_key: Invalid private key format. Expecting 32 bytes, but got ${e.length}`);return function(t){try{const r=Vn.sign(cs(t),e);return Promise.resolve(es({r:ns(r.r.toString(16)),s:ns(r.s.toString(16))}))}catch(e){return Promise.reject(e)}}}function vs(e){return"object"==typeof e&&"r"in e&&"s"in e}function Es(e){return function(t,r){try{return Promise.resolve(r(t)).then((function(t){if(vs(t))return es(t,e);if(e&&void 0===ts(t).recoveryParam)throw new Error("not_supported: ES256K-R not supported when signer doesn't provide a recovery param");return t}))}catch(e){return Promise.reject(e)}}}function xs(){return function(e,t){try{return Promise.resolve(t(e)).then((function(e){if(vs(e))throw new Error("invalid_config: expected a signer function that returns a string instead of signature object");return e}))}catch(e){return Promise.reject(e)}}}const As={ES256:function(e,t){try{return Promise.resolve(t(e)).then((function(e){return vs(e)?es(e):e}))}catch(e){return Promise.reject(e)}},ES256K:Es(),"ES256K-R":Es(!0),Ed25519:xs(),EdDSA:xs()};function Bs(e,t=!1){const r=$i(e);if(r.length!==(t?65:64))throw new Error("wrong signature length");return{compact:r.slice(0,64),recovery:r[64]}}function Ss(e,t,r){const n=[];if(t.length>86)n.push(Bs(t,!0));else{const e=Bs(t,!1);n.push({...e,recovery:0}),n.push({...e,recovery:1})}const o=cs(e),i=e=>{const t=Nn.Signature.fromCompact(e.compact).addRecoveryBit(e.recovery||0).recoverPublicKey(o),n=us(t.toHex(!1)).toLowerCase(),i=t.toHex(!1),s=t.toHex(!0);return r.find((e=>{const{keyBytes:t}=Ji(e),r=Xi(t);return r===i||r===s||e.ethereumAddress?.toLowerCase()===n||e.blockchainAccountId?.split("@eip155")?.[0].toLowerCase()===n||function(e,t){if(t){const r=t.split(":");switch(r[0]){case"bip122":r[r.length-1]=function(e,t){const r=Xi(ji(t).slice(0,1)),n=qi(e),o=r+Xi(no(cs(n))),i=cs(qi(o));return _i(qi(o+Xi(cs(i)).substring(0,8)))}(e,r[r.length-1]);break;case"cosmos":r[r.length-1]=function(e,t){const r=Nn.ProjectivePoint.fromHex(e).toRawBytes(),n=no(cs(r)),o=ei.toWords(n);return ei.encode(t,o).replace(t,"")}(e,r[1]);break;case"eip155":r[r.length-1]=us(e);break;default:return!1}return r.join(":").toLowerCase()===t.toLowerCase()}return!1}(i,e.blockchainAccountId)}))};for(const e of n){const t=i(e);if(t)return t}throw new Error("invalid_signature: Signature invalid for JWT")}function Is(e,t,r){const n=Qi(e),o=$i(t),i=r.find((e=>{const{keyBytes:t,keyType:r}=Ji(e);return"Ed25519"===r&&un.verify(o,n,t)}));if(!i)throw new Error("invalid_signature: Signature invalid for JWT");return i}const ks={ES256:function(e,t,r){const n=cs(e),o=Vn.Signature.fromCompact(Bs(t).compact),i=r.filter((e=>!e.ethereumAddress&&!e.blockchainAccountId)).find((e=>{try{const{keyBytes:t}=Ji(e);return Vn.verify(o,n,t)}catch(e){return!1}}));if(!i)throw new Error("invalid_signature: Signature invalid for JWT");return i},ES256K:function(e,t,r){const n=cs(e),o=Nn.Signature.fromCompact($i(t)).normalizeS(),i=r.filter((e=>!e.ethereumAddress&&!e.blockchainAccountId)),s=r.filter((e=>e.ethereumAddress||e.blockchainAccountId));let f=i.find((e=>{try{const{keyBytes:t}=Ji(e);return Nn.verify(o,n,t)}catch(e){return!1}}));if(!f&&s.length>0&&(f=Ss(e,t,s)),!f)throw new Error("invalid_signature: Signature invalid for JWT");return f},"ES256K-R":Ss,Ed25519:Is,EdDSA:Is};function Us(e){const t=ks[e];if(!t)throw new Error(`not_supported: Unsupported algorithm ${e}`);return t}Us.toSignatureObject=function(e,t=!1){const r=$i(e);if(r.length!==(t?65:64))throw new Error("wrong signature length");const n={r:Xi(r.slice(0,32)),s:Xi(r.slice(32,64))};return t&&(n.recoveryParam=r[64]),n};const Ps={INVALID_JWT:"invalid_jwt",INVALID_AUDIENCE:"invalid_config",INVALID_SIGNATURE:"invalid_signature",NO_SUITABLE_KEYS:"no_suitable_keys",NOT_SUPPORTED:"not_supported",RESOLVER_ERROR:"resolver_error"},Os="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function Rs(e,t,r){if(!e.s){if(r instanceof Ts){if(!r.s)return void(r.o=Rs.bind(null,e,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(Rs.bind(null,e,t),Rs.bind(null,e,2));e.s=t,e.v=r;const n=e.o;n&&n(e)}}const Ts=function(){function e(){}return e.prototype.then=function(t,r){const n=new e,o=this.s;if(o){const e=1&o?t:r;if(e){try{Rs(n,1,e(this.v))}catch(e){Rs(n,2,e)}return n}return this}return this.o=function(e){try{const o=e.v;1&e.s?Rs(n,1,t?t(o):o):r?Rs(n,1,r(o)):Rs(n,2,o)}catch(e){Rs(n,2,e)}},n},e}();function Ns(e){return e instanceof Ts&&1&e.s}const Cs=function(e,{header:t,payload:r,data:n,signature:o},i,s){try{let f;function c(e){if(f)return e;throw new Error(`${Ps.INVALID_SIGNATURE}: condition for authenticator ${i.id} is not met.`)}if(!i.conditionWeightedThreshold||!i.threshold)throw new Error("Expected conditionWeightedThreshold and threshold");const a=[],u=i.threshold;let h=0;const d=function(e,t,r){if("function"==typeof e[Os]){var n,o,i,s=e[Os]();function u(e){try{for(;!((n=s.next()).done||r&&r());)if((e=t(n.value))&&e.then){if(!Ns(e))return void e.then(u,i||(i=Rs.bind(null,o=new Ts,2)));e=e.v}o?Rs(o,1,e):o=e}catch(e){Rs(o||(o=new Ts),2,e)}}if(u(),s.return){var f=function(e){try{n.done||s.return()}catch(e){}return e};if(o&&o.then)return o.then(f,(function(e){throw f(e)}));f()}return o}if(!("length"in e))throw new TypeError("Object is not iterable");for(var c=[],a=0;a<e.length;a++)c.push(e[a]);return function(e,t,r){var n,o,i=-1;return function s(f){try{for(;++i<e.length&&(!r||!r());)if((f=t(i))&&f.then){if(!Ns(f))return void f.then(s,o||(o=Rs.bind(null,n=new Ts,2)));f=f.v}n?Rs(n,1,f):n=f}catch(e){Rs(n||(n=new Ts),2,e)}}(),n}(c,(function(e){return t(c[e])}),r)}(i.conditionWeightedThreshold,(function(c){function d(e){return f?e:p&&!a.includes(p.id)&&(a.push(p.id),h+=c.weight,h>=u)?(f=1,i):void 0}const l=c.condition;let p;const y=function(i,f){try{var c=function(){if(l.type===Ls){if(!s.didAuthenticator)throw new Error("Expected didAuthenticator");const t={...s,didAuthenticator:{didResolutionResult:s.didAuthenticator?.didResolutionResult,authenticators:[l],issuer:l.id}};return Promise.resolve(Vs(e,t)).then((function({verified:e}){e&&(p=l)}))}return Promise.resolve(ef({header:t,payload:r,data:n,signature:o},l)).then((function(e){p=e}))}()}catch(e){return f(e)}return c&&c.then?c.then(void 0,f):c}(0,(function(e){if(!e.message.startsWith(Ps.INVALID_SIGNATURE))throw e}));return y&&y.then?y.then(d):d(y)}),(function(){return f}));return Promise.resolve(d&&d.then?d.then(c):c(d))}catch(l){return Promise.reject(l)}},Ks=function(e,{header:t,payload:r,signature:n,data:o},i,s){try{return i.type===Ls?function(e,{header:t,payload:r,signature:n,data:o},i,s){try{if(i.conditionWeightedThreshold)return Cs(e,{header:t,payload:r,data:o,signature:n},i,s);if(i.conditionDelegated)return function(e,{header:t,payload:r,data:n,signature:o},i,s){try{if(!i.conditionDelegated)throw new Error("Expected conditionDelegated");if(!s.resolver)throw new Error("Expected resolver");let f;const c=i.conditionDelegated;return Promise.resolve(_s(s.resolver,t.alg,c,s.proofPurpose)).then((function(a){function u(e){if(f)return i;throw new Error(`${Ps.INVALID_SIGNATURE}: condition for authenticator ${i.id} is not met.`)}const h=a.didResolutionResult;if(!h?.didDocument)throw new Error(`${Ps.RESOLVER_ERROR}: Could not resolve delegated DID ${c}.`);const d=a.authenticators.find((e=>e.id===c));if(!d)throw new Error(`${Ps.NO_SUITABLE_KEYS}: Could not find delegated authenticator ${c} in it's DID Document`);const l=function(){if(d.type===Ls)return Promise.resolve(Vs(e,{...s,didAuthenticator:{didResolutionResult:h,authenticators:[d],issuer:d.id}})).then((function({verified:e}){e&&(f=d)}));try{f=ef({header:t,payload:r,data:n,signature:o},d)}catch(e){if(!e.message.startsWith("invalid_signature:"))throw e}}();return l&&l.then?l.then(u):u()}))}catch(e){return Promise.reject(e)}}(e,{header:t,payload:r,data:o,signature:n},i,s);throw new Error(`${Ps.INVALID_JWT}: conditional proof type did not find condition for authenticator ${i.id}.`)}catch(e){return Promise.reject(e)}}(e,{payload:r,header:t,signature:n,data:o},i,s):Promise.resolve(ef({header:t,payload:r,data:o,signature:n},[i]))}catch(e){return Promise.reject(e)}},Ls="ConditionalProof2022";function Ds(e,t,r){if(!e.s){if(r instanceof $s){if(!r.s)return void(r.o=Ds.bind(null,e,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(Ds.bind(null,e,t),Ds.bind(null,e,2));e.s=t,e.v=r;const n=e.o;n&&n(e)}}const $s=function(){function e(){}return e.prototype.then=function(t,r){const n=new e,o=this.s;if(o){const e=1&o?t:r;if(e){try{Ds(n,1,e(this.v))}catch(e){Ds(n,2,e)}return n}return this}return this.o=function(e){try{const o=e.v;1&e.s?Ds(n,1,t?t(o):o):r?Ds(n,1,r(o)):Ds(n,2,o)}catch(e){Ds(n,2,e)}},n},e}();function js(e){return e instanceof $s&&1&e.s}const _s=function(e,t,r,n){try{const o=Vi[t];if(!o||0===o.length)throw new Error(`${Ps.NOT_SUPPORTED}: No supported signature types for algorithm ${t}`);let i;return Promise.resolve(e.resolve(r,{accept:Gs})).then((function(e){if(i=-1===Object.getOwnPropertyNames(e).indexOf("didDocument")?{didDocument:e,didDocumentMetadata:{},didResolutionMetadata:{contentType:Gs}}:e,i.didResolutionMetadata?.error||null==i.didDocument){const{error:e,message:t}=i.didResolutionMetadata;throw new Error(`${Ps.RESOLVER_ERROR}: Unable to resolve DID document for ${r}: ${e}, ${t||""}`)}const s=(e,t)=>{const r=e.filter((({id:e})=>t===e));return r.length>0?r[0]:null};let f=[...i?.didDocument?.verificationMethod||[],...i?.didDocument?.publicKey||[]];"string"==typeof n&&(n.startsWith("assertion")&&!Object.getOwnPropertyNames(i?.didDocument).includes("assertionMethod")&&(i.didDocument={...i.didDocument},i.didDocument.assertionMethod=[...f.map((e=>e.id))]),f=(i.didDocument[n]||[]).map((e=>"string"==typeof e?s(f,e):"string"==typeof e.publicKey?s(f,e.publicKey):e)).filter((e=>null!=e)));const c=f.filter((({type:e})=>o.find((t=>t===e))));if("string"==typeof n&&(!c||0===c.length))throw new Error(`${Ps.NO_SUITABLE_KEYS}: DID document for ${r} does not have public keys suitable for ${t} with ${n} purpose`);if(!c||0===c.length)throw new Error(`${Ps.NO_SUITABLE_KEYS}: DID document for ${r} does not have public keys for ${t}`);return{authenticators:c,issuer:r,didResolutionResult:i}}))}catch(e){return Promise.reject(e)}},Vs=function(e,t={resolver:void 0,auth:void 0,audience:void 0,callbackUrl:void 0,skewTime:void 0,proofPurpose:void 0,policies:{},didAuthenticator:void 0}){try{function r(){function r(r){if(d){const r="number"==typeof t.policies?.now?t.policies.now:Math.floor(Date.now()/1e3),o=void 0!==t.skewTime&&t.skewTime>=0?t.skewTime:Xs,i=r+o;if(!1!==t.policies?.nbf&&n.nbf){if(n.nbf>i)throw new Error(`${Ps.INVALID_JWT}: JWT not valid before nbf: ${n.nbf}`)}else if(!1!==t.policies?.iat&&n.iat&&n.iat>i)throw new Error(`${Ps.INVALID_JWT}: JWT not valid yet (issued in the future) iat: ${n.iat}`);if(!1!==t.policies?.exp&&n.exp&&n.exp<=r-o)throw new Error(`${Ps.INVALID_JWT}: JWT has expired: exp: ${n.exp} < now: ${r}`);if(!1!==t.policies?.aud&&n.aud){if(!t.audience&&!t.callbackUrl)throw new Error(`${Ps.INVALID_AUDIENCE}: JWT audience is required but your app address has not been configured`);if(void 0===(Array.isArray(n.aud)?n.aud:[n.aud]).find((e=>t.audience===e||t.callbackUrl===e)))throw new Error(`${Ps.INVALID_AUDIENCE}: JWT audience does not match your DID or callback url`)}return{verified:!0,payload:n,didResolutionResult:h,issuer:u,signer:d,jwt:e,policies:t.policies}}throw new Error(`${Ps.INVALID_SIGNATURE}: JWT not valid. issuer DID document does not contain a verificationMethod that matches the signature.`)}const{did:f}=function(e){if(""===e||!e)return null;const t=e.match(Bo);if(t){const r={did:`did:${t[1]}:${t[2]}`,method:t[1],id:t[2],didUrl:e};if(t[4]){const e=t[4].slice(1).split(";");r.params={};for(const t of e){const e=t.split("=");r.params[e[0]]=e[1]}}return t[6]&&(r.path=t[6]),t[7]&&(r.query=t[7].slice(1)),t[8]&&(r.fragment=t[8].slice(1)),r}return null}(c);let d=null;const l=function(){if(f!==c){const r=a.find((e=>e.id===c));if(!r)throw new Error(`${Ps.INVALID_JWT}: No authenticator found for did URL ${c}`);return Promise.resolve(Ks(e,{payload:n,header:o,signature:i,data:s},r,t)).then((function(e){d=e}))}{let r=0;return function(e,t,r){for(var n;;){var o=e();if(js(o)&&(o=o.v),!o)return s;if(o.then){n=0;break}var i,s=r();if(s&&s.then){if(!js(s)){n=1;break}s=s.s}}var f=new $s,c=Ds.bind(null,f,2);return(0===n?o.then(u):1===n?s.then(a):i.then(h)).then(void 0,c),f;function a(t){s=t;do{if(!(o=e())||js(o)&&!o.v)return void Ds(f,1,s);if(o.then)return void o.then(u).then(void 0,c);js(s=r())&&(s=s.v)}while(!s||!s.then);s.then(a).then(void 0,c)}function u(e){e?(s=r())&&s.then?s.then(a).then(void 0,c):a(s):Ds(f,1,s)}function h(){(o=e())?o.then?o.then(u).then(void 0,c):u(o):Ds(f,1,s)}}((function(){return!d&&r<a.length}),0,(function(){function f(e){r++}const c=a[r],u=function(r,f){try{var a=Promise.resolve(Ks(e,{payload:n,header:o,signature:i,data:s},c,t)).then((function(e){d=e}))}catch(e){return f(e)}return a&&a.then?a.then(void 0,f):a}(0,(function(e){if(!e.message.includes(Ps.INVALID_SIGNATURE)||r===a.length-1)throw e}));return u&&u.then?u.then(f):f()}))}}();return l&&l.then?l.then(r):r()}if(!t.resolver)throw new Error("missing_resolver: No DID resolver has been configured");const{payload:n,header:o,signature:i,data:s}=Qs(e,!1),f=Object.prototype.hasOwnProperty.call(t,"auth")?t.auth?"authentication":void 0:t.proofPurpose;let c,a,u,h;if(!n.iss&&!n.client_id)throw new Error(`${Ps.INVALID_JWT}: JWT iss or client_id are required`);if(t.didAuthenticator)c=t.didAuthenticator.issuer;else if(n.iss===Js||n.iss===Ms){if(!n.sub)throw new Error(`${Ps.INVALID_JWT}: JWT sub is required`);c=void 0===n.sub_jwk?n.sub:(o.kid||"").split("#")[0]}else if(n.iss===Ws){if(!n.did)throw new Error(`${Ps.INVALID_JWT}: JWT did is required`);c=n.did}else if(!n.iss&&"openid"===n.scope&&n.redirect_uri){if(!n.client_id)throw new Error(`${Ps.INVALID_JWT}: JWT client_id is required`);c=n.client_id}else c=n.iss;if(!c)throw new Error(`${Ps.INVALID_JWT}: No DID has been found in the JWT`);const d=function(){if(!t.didAuthenticator)return Promise.resolve(_s(t.resolver,o.alg,c,f)).then((function(e){({didResolutionResult:h,authenticators:a,issuer:u}=e),t.didAuthenticator={didResolutionResult:h,authenticators:a,issuer:u}}));({didResolutionResult:h,authenticators:a,issuer:u}=t.didAuthenticator)}();return Promise.resolve(d&&d.then?d.then(r):r())}catch(l){return Promise.reject(l)}},Fs=function(e,{expiresIn:t,canonicalize:r},n){try{if(0===n.length)throw new Error("invalid_argument: must provide one or more issuers");let a=e,u="";const h=(o=n,i=function(e){const o=n[e],i={typ:"JWT",alg:o.alg};return 0!==e&&(i.cty="JWT"),Promise.resolve(Hs(a,{...o,canonicalize:r,expiresIn:t},i)).then((function(e){u=e,a={jwt:u}}))},c=-1,function e(t){try{for(;++c<o.length;)if((t=i(c))&&t.then){if(!js(t))return void t.then(e,f||(f=Ds.bind(null,s=new $s,2)));t=t.v}s?Ds(s,1,t):s=t}catch(e){Ds(s||(s=new $s),2,e)}}(),s);return Promise.resolve(h&&h.then?h.then((function(){return u})):u)}catch(e){return Promise.reject(e)}var o,i,s,f,c},Hs=function(e,{issuer:t,signer:r,alg:n,expiresIn:o,canonicalize:i},s={}){try{if(!r)throw new Error("missing_signer: No Signer functionality has been configured");if(!t)throw new Error("missing_issuer: No issuing DID has been configured");s.typ||(s.typ="JWT"),s.alg||(s.alg=n);const f={iat:Math.floor(Date.now()/1e3),exp:void 0};if(o){if("number"!=typeof o)throw new Error("invalid_argument: JWT expiresIn is not a number");f.exp=(e.nbf||f.iat)+Math.floor(o)}const c={...f,...e,iss:t};return zs(c,r,s,{canonicalize:i})}catch(e){return Promise.reject(e)}},zs=function(e,t,r={},n={}){try{r.alg||(r.alg=qs);const o="string"==typeof e?e:Zs(e,n.canonicalize),i=[Zs(r,n.canonicalize),o].join("."),s=function(e){const t=As[e];if(!t)throw new Error(`not_supported: Unsupported algorithm ${e}`);return t}(r.alg);return Promise.resolve(s(i,t)).then((function(e){return[i,e].join(".")}))}catch(e){return Promise.reject(e)}},Js="https://self-issued.me/v2",Ms="https://self-issued.me/v2/openid-vc",Ws="https://self-issued.me",qs="ES256K",Gs="application/did+json";function Zs(e,t=!1){return Gi(t?Eo(e):JSON.stringify(e))}const Xs=300;function Ys(e){const t=e.match(/^([a-zA-Z0-9_-]+)\.([a-zA-Z0-9_-]+)\.([a-zA-Z0-9_-]+)$/);if(t)return{header:JSON.parse(Zi(t[1])),payload:t[2],signature:t[3],data:`${t[1]}.${t[2]}`};throw new Error("invalid_argument: Incorrect format JWS")}function Qs(e,t=!0){if(!e)throw new Error("invalid_argument: no JWT passed into decodeJWT");try{const r=Ys(e),n=Object.assign(r,{payload:JSON.parse(Zi(r.payload))}),o=n.payload.iss;if("JWT"===n.header.cty&&t){const e=Qs(n.payload.jwt);if(e.payload.iss!==o)throw new Error(`${Ps.INVALID_JWT}: multiple issuers`);return e}return n}catch(e){throw new Error(`invalid_argument: ${Ps.INVALID_JWT}: ${e}`)}}function ef({header:e,payload:t,data:r,signature:n},o){Array.isArray(o)||(o=[o]);const i=t.iss;let s=!0;do{if(i!==t.iss)throw new Error(`${Ps.INVALID_JWT}: multiple issuers`);try{return Us(e.alg)(r,n,o)}catch(e){if(!e.message.startsWith(Ps.INVALID_SIGNATURE))throw e}"JWT"!==e.cty?s=!1:({payload:t,header:e,signature:n,data:r}=Qs(t.jwt,!1))}while(s);throw new Error(`${Ps.INVALID_SIGNATURE}: no matching public key found`)}function tf(e,t){return function({header:e,data:t,signature:r},n){return Array.isArray(n)||(n=[n]),Us(e.alg)(t,r,n)}(Ys(e),t)}const rf="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function nf(e,t,r){if(!e.s){if(r instanceof of){if(!r.s)return void(r.o=nf.bind(null,e,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(nf.bind(null,e,t),nf.bind(null,e,2));e.s=t,e.v=r;const n=e.o;n&&n(e)}}const of=function(){function e(){}return e.prototype.then=function(t,r){const n=new e,o=this.s;if(o){const e=1&o?t:r;if(e){try{nf(n,1,e(this.v))}catch(e){nf(n,2,e)}return n}return this}return this.o=function(e){try{const o=e.v;1&e.s?nf(n,1,t?t(o):o):r?nf(n,1,r(o)):nf(n,2,o)}catch(e){nf(n,2,e)}},n},e}();function sf(e){return e instanceof of&&1&e.s}function ff({ciphertext:e,tag:t,iv:r,protectedHeader:n,recipient:o},i){const s={protected:n,iv:Di(r??new Uint8Array(0)),ciphertext:Di(e),tag:Di(t??new Uint8Array(0))};return i&&(s.aad=Di(i)),o&&(s.recipients=[o]),s}const cf=function(e,t){try{function r(e){if(null===s)throw new Error("failure: Failed to decrypt");return s}!function(e){if(!(e.protected&&e.iv&&e.ciphertext&&e.tag))throw new Error("bad_jwe: missing properties");e.recipients&&e.recipients.map((e=>{if(!e.header||!e.encrypted_key)throw new Error("bad_jwe: malformed recipients")}))}(e);const n=JSON.parse(Zi(e.protected));if(n.enc!==t.enc)throw new Error(`not_supported: Decrypter does not supported: '${n.enc}'`);const o=rs(e.ciphertext,e.tag),i=Qi(e.aad?`${e.protected}.${e.aad}`:e.protected);let s=null;const f="dir"===n.alg&&"dir"===t.alg?Promise.resolve(t.decrypt(o,$i(e.iv),i)).then((function(e){s=e})):function(){if(e.recipients&&0!==e.recipients.length){let r=0;return function(e,t,r){for(var n;;){var o=e();if(sf(o)&&(o=o.v),!o)return i;if(o.then){n=0;break}var i=r();if(i&&i.then){if(!sf(i)){n=1;break}i=i.s}if(t){var s=t();if(s&&s.then&&!sf(s)){n=2;break}}}var f=new of,c=nf.bind(null,f,2);return(0===n?o.then(u):1===n?i.then(a):s.then(h)).then(void 0,c),f;function a(n){i=n;do{if(t&&(s=t())&&s.then&&!sf(s))return void s.then(h).then(void 0,c);if(!(o=e())||sf(o)&&!o.v)return void nf(f,1,i);if(o.then)return void o.then(u).then(void 0,c);sf(i=r())&&(i=i.v)}while(!i||!i.then);i.then(a).then(void 0,c)}function u(e){e?(i=r())&&i.then?i.then(a).then(void 0,c):a(i):nf(f,1,i)}function h(){(o=e())?o.then?o.then(u).then(void 0,c):u(o):nf(f,1,i)}}((function(){return!s&&r<e.recipients.length}),(function(){return r++}),(function(){const f=e.recipients[r];Object.assign(f.header,n);const c=function(){if(f.header.alg===t.alg)return Promise.resolve(t.decrypt(o,$i(e.iv),i,f)).then((function(e){s=e}))}();if(c&&c.then)return c.then((function(){}))}))}throw new Error("bad_jwe: missing recipients")}();return Promise.resolve(f&&f.then?f.then(r):r())}catch(c){return Promise.reject(c)}},af=function(e,t,r={},n,o=!1){try{if("dir"===t[0].alg){if(t.length>1)throw new Error('not_supported: Can only do "dir" encryption to one key.');return Promise.resolve(t[0].encrypt(e,r,n)).then((function(e){return ff(e,n)}))}{const i=t[0].enc;if(!t.reduce(((e,t)=>e&&t.enc===i),!0))throw new Error("invalid_argument: Incompatible encrypters passed");let s,f,c;if(o){c=t[0].genEpk?.();const e=t[0].alg;r={...r,alg:e,epk:c?.publicKeyJWK}}const a=function(e,t,r){if("function"==typeof e[rf]){var n,o,i,s=e[rf]();function u(e){try{for(;!((n=s.next()).done||r&&r());)if((e=t(n.value))&&e.then){if(!sf(e))return void e.then(u,i||(i=nf.bind(null,o=new of,2)));e=e.v}o?nf(o,1,e):o=e}catch(e){nf(o||(o=new of),2,e)}}if(u(),s.return){var f=function(e){try{n.done||s.return()}catch(e){}return e};if(o&&o.then)return o.then(f,(function(e){throw f(e)}));f()}return o}if(!("length"in e))throw new TypeError("Object is not iterable");for(var c=[],a=0;a<e.length;a++)c.push(e[a]);return function(e,t,r){var n,o,i=-1;return function s(f){try{for(;++i<e.length&&(!r||!r());)if((f=t(i))&&f.then){if(!sf(f))return void f.then(s,o||(o=nf.bind(null,n=new of,2)));f=f.v}n?nf(n,1,f):n=f}catch(e){nf(n||(n=new of),2,e)}}(),n}(c,(function(e){return t(c[e])}),r)}(t,(function(t){const o=s?Promise.resolve(t.encryptCek?.(s,c)).then((function(e){e&&f?.recipients?.push(e)})):Promise.resolve(t.encrypt(e,r,n,c)).then((function(e){s=e.cek,f=ff(e,n)}));if(o&&o.then)return o.then((function(){}))}));return Promise.resolve(a&&a.then?a.then((function(){return f})):f)}}catch(e){return Promise.reject(e)}};function uf(e){return(t,r)=>{const n=dt(24),o=Ki(e,n,r).encrypt(t);return{ciphertext:o.subarray(0,o.length-16),tag:o.subarray(o.length-16),iv:n}}}function hf(e){const t=uf(e),r="XC20P";return{alg:"dir",enc:r,encrypt:function(e,n={},o){try{const i=Gi(JSON.stringify(Object.assign({alg:"dir"},n,{enc:r}))),s=Qi(o?`${i}.${Di(o)}`:i);return Promise.resolve({...t(e,s),protectedHeader:i})}catch(e){return Promise.reject(e)}}}}function df(e){return{alg:"dir",enc:"XC20P",decrypt:function(t,r,n){try{try{return Promise.resolve(Ki(e,r,n).decrypt(t))}catch(e){return Promise.resolve(null)}}catch(e){return Promise.reject(e)}}}}const lf=function(e,t,r,n,o,i){try{const t="X25519",n=256,s=i?is(i.secretKey):os(),f={kty:"OKP",crv:t,x:Di(s.publicKey)},c=ls(hn.getSharedSecret(s.secretKey,e),n,r,void 0,$i(o??""));return Promise.resolve({epk:f,kek:c})}catch(e){return Promise.reject(e)}},pf=function(e,t,r){try{function n(){let t,n;return e.header.apu&&(t=$i(e.header.apu)),e.header.apv&&(n=$i(e.header.apv)),ls(c,i,r,t,n)}const o="X25519",i=256,s=e.header;if(s.epk?.crv!==o||void 0===s.epk.x)return Promise.resolve(null);const f=$i(s.epk.x);let c;const a=function(){if(!(t instanceof Uint8Array))return Promise.resolve(t(f)).then((function(e){c=e}));c=hn.getSharedSecret(t,f)}();return Promise.resolve(a&&a.then?a.then(n):n())}catch(u){return Promise.reject(u)}},yf=function(e,t,r,n,o,i){try{function s(){const e=new Uint8Array(h.length+d.length);e.set(h),e.set(d,h.length);let t=new Uint8Array(0),i=new Uint8Array(0);n&&(t=$i(n)),o&&(i=$i(o));const s=ls(e,c,r,t,i);return{epk:u,kek:s}}const f="X25519",c=256,a=i?is(i.secretKey):os(),u={kty:"OKP",crv:f,x:Di(a.publicKey)},h=hn.getSharedSecret(a.secretKey,e);let d;const l=function(){if(!(t instanceof Uint8Array))return Promise.resolve(t(e)).then((function(e){d=e}));d=hn.getSharedSecret(t,e)}();return Promise.resolve(l&&l.then?l.then(s):s())}catch(p){return Promise.reject(p)}},wf=function(e,t,r,n){try{function o(){const t=new Uint8Array(a.length+u.length);let r,o;return t.set(a),t.set(u,a.length),e.header.apu&&(r=$i(e.header.apu)),e.header.apv&&(o=$i(e.header.apv)),ls(t,s,n,r,o)}const i="X25519",s=256,f=e.header;if(f.epk?.crv!==i||void 0===f.epk.x)return Promise.resolve(null);const c=$i(f.epk.x);let a,u;const h=function(){if(!(t instanceof Uint8Array))return Promise.resolve(t(c)).then((function(e){return a=e,Promise.resolve(t(r)).then((function(e){u=e}))}));a=hn.getSharedSecret(t,c),u=hn.getSharedSecret(t,r)}();return Promise.resolve(h&&h.then?h.then(o):o())}catch(d){return Promise.reject(d)}};function gf(e){if(32!==e.length)throw new Error("invalid_argument: incorrect secret key length for X25519");return function(t){try{if(32!==t.length)throw new Error("invalid_argument: incorrect publicKey key length for X25519");return Promise.resolve(hn.getSharedSecret(e,t))}catch(e){return Promise.reject(e)}}}function bf(e,t,r={},n,o,i){const s=function(i,s){try{return Promise.resolve(n.createKek(e,t,`${n.alg}+${o.alg}`,r.apu,r.apv,s)).then((function({epk:e,kek:t}){return Promise.resolve(o.from(t).wrap(i)).then((function(t){const i={encrypted_key:Di(t.ciphertext),header:{}};return t.iv&&(i.header.iv=Di(t.iv)),t.tag&&(i.header.tag=Di(t.tag)),r.kid&&(i.header.kid=r.kid),r.apu&&(i.header.apu=r.apu),r.apv&&(i.header.apv=r.apv),s||(i.header.alg=`${n.alg}+${o.alg}`,i.header.epk=e),i}))}))}catch(e){return Promise.reject(e)}};return{alg:o.alg,enc:i.enc,encrypt:function(e,t={},r,f){try{Object.assign(t,{alg:void 0});const c=dt(32);return Promise.resolve(s(c,f)).then((function(s){return f&&(t.alg=`${n.alg}+${o.alg}`,t.epk=f.publicKeyJWK),Promise.resolve(i.from(c).encrypt(e,t,r)).then((function(e){return{...e,recipient:s,cek:c}}))}))}catch(e){return Promise.reject(e)}},encryptCek:s,genEpk:ss}}const mf=function(e,t){try{const r=function(e,n=[]){try{return Promise.resolve(t.resolve(e)).then((function({didResolutionMetadata:t,didDocument:o}){function i(){const t=o.keyAgreement?.map((e=>"string"==typeof e?[...o.publicKey||[],...o.verificationMethod||[]].find((t=>t.id===e)):e))?.filter((e=>void 0!==e)),r=t?.filter((e=>["X25519KeyAgreementKey2019","X25519KeyAgreementKey2020","JsonWebKey2020","Multikey"].includes(e.type)))??[];if(!r.length&&!s.length)throw new Error(`no_suitable_keys: Could not find X25519 key for ${e}`);return r.map((e=>{const{keyBytes:t,keyType:r}=Ji(e);return"X25519"===r?If(t,e.id):null})).filter(fs).concat(...s)}if(n.push(e),t?.error||null==o)throw new Error(`resolver_error: Could not resolve ${e}: ${t.error}, ${t.message}`);let s=[];if(!o.controller&&!o.keyAgreement)throw new Error(`no_suitable_keys: Could not find x25519 key for ${e}`);const f=function(){if(o.controller){let e=Array.isArray(o.controller)?o.controller:[o.controller];e=e.filter((e=>!n.includes(e)));const t=e.map((e=>r(e,n).catch((()=>[]))));return Promise.resolve(Promise.all(t)).then((function(e){s=[].concat(...e)}))}}();return f&&f.then?f.then(i):i()}))}catch(e){return Promise.reject(e)}},n=e.map((e=>r(e)));return Promise.resolve(Promise.all(n)).then((function(e){return[].concat(...e)}))}catch(e){return Promise.reject(e)}};function vf(e,t,r={}){return Uf(e,t,r)}function Ef(e,t={}){return kf(e,t)}function xf(e,t){return Rf(e,t)}function Af(e){return Of(e)}function Bf(e){if(!(e&&e.epk&&e.iv&&e.tag))throw new Error("bad_jwe: malformed header");return e}const Sf={from:e=>({wrap:function(t){try{return Promise.resolve(uf(e)(t))}catch(e){return Promise.reject(e)}}}),alg:"XC20PKW"};function If(e,t,r){return kf(e,{kid:t,apv:r})}function kf(e,t={}){return bf(e,void 0,t,{createKek:lf,alg:"ECDH-ES"},Sf,{from:e=>hf(e),enc:"XC20P"})}function Uf(e,t,r={}){return bf(e,t,r,{createKek:yf,alg:"ECDH-1PU"},Sf,{from:e=>hf(e),enc:"XC20P"})}function Pf(e){return Of(e)}function Of(e){const t="ECDH-ES+XC20PKW";return{alg:t,enc:"XC20P",decrypt:function(r,n,o,i){try{const s=Bf(i.header);return Promise.resolve(pf(i,e,t)).then((function(e){if(!e)return null;const t=rs(i.encrypted_key,s.tag);return Promise.resolve(df(e).decrypt(t,$i(s.iv))).then((function(e){return null===e?null:df(e).decrypt(r,n,o)}))}))}catch(e){return Promise.reject(e)}}}}function Rf(e,t){const r="ECDH-1PU+XC20PKW";return{alg:r,enc:"XC20P",decrypt:function(n,o,i,s){try{const f=Bf(s.header);return Promise.resolve(wf(s,e,t,r)).then((function(e){if(!e)return null;const t=rs(s.encrypted_key,f.tag);return Promise.resolve(df(e).decrypt(t,$i(f.iv))).then((function(e){return null===e?null:df(e).decrypt(n,o,i)}))}))}catch(e){return Promise.reject(e)}}}}export{ps as ES256KSigner,ms as ES256Signer,gs as EdDSASigner,ws as EllipticSigner,Ps as JWT_ERROR,bs as NaclSigner,ys as SimpleSigner,ji as base58ToBytes,$i as base64ToBytes,_i as bytesToBase58,Di as bytesToBase64url,Xi as bytesToHex,Mi as bytesToMultibase,wf as computeX25519Ecdh1PUv3Kek,pf as computeX25519EcdhEsKek,ls as concatKDF,Af as createAnonDecrypter,Ef as createAnonEncrypter,xf as createAuthDecrypter,vf as createAuthEncrypter,bf as createFullEncrypter,af as createJWE,zs as createJWS,Hs as createJWT,Fs as createMultisignatureJWT,gf as createX25519ECDH,yf as createX25519Ecdh1PUv3Kek,lf as createX25519EcdhEsKek,Qs as decodeJWT,cf as decryptJWE,Ji as extractPublicKeyBytes,ss as genX25519EphemeralKeyPair,qi as hexToBytes,Wi as multibaseToBytes,mf as resolveX25519Encrypters,Hi as supportedCodecs,us as toEthereumAddress,tf as verifyJWS,Vs as verifyJWT,Pf as x25519Decrypter,If as x25519Encrypter,Rf as xc20pAuthDecrypterEcdh1PuV3x25519WithXc20PkwV2,Uf as xc20pAuthEncrypterEcdh1PuV3x25519WithXc20PkwV2,df as xc20pDirDecrypter,hf as xc20pDirEncrypter};